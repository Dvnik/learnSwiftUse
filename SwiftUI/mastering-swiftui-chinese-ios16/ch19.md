# ç¬¬ 19 ç«  ä½¿ç”¨æ‰‹å‹¢èˆ‡å‹•ç•«å»ºç«‹å¦‚ Tinder èˆ¬çš„ UI

Class: ç²¾é€šSwiftUI
Created: December 28, 2022 4:36 PM
Reviewed: No
Type: SwiftUI4

å»ºç«‹å¦‚Tinder èˆ¬çš„ä½¿ç”¨è€…ä»‹é¢

# ****å°ˆæ¡ˆæº–å‚™****

<aside>
ğŸ’¡ ç”±æ–¼æ˜¯æ¨¡ä»¿Tinderçš„UIï¼Œæ‰€ä»¥ä¸æœƒåšå…¨ä¸çš„å·¥èƒ½ã€‚åƒ…è‘—ä¸­åœ¨UIè¡¨ç¾ã€‚(å°ˆæ¡ˆåç¨±ï¼š`SwiftUITinderTrip`)

</aside>

Trip.swift

```python
struct Trip {
    var destination: String
    var image: String
}

#if DEBUG
var trips = [ Trip(destination: "Yosemite, USA", image: "yosemite-usa"),
              Trip(destination: "Venice, Italy", image: "venice-italy"),
              Trip(destination: "Hong Kong", image: "hong-kong"),
              Trip(destination: "Barcelona, Spain", image: "barcelona-spain"),
              Trip(destination: "Braies, Italy", image: "braies-italy"),
              Trip(destination: "Kanangra, Australia", image: "kanangra-australia"),
              Trip(destination: "Mount Currie, Canada", image: "mount-currie-canada"),
              Trip(destination: "Ohrid, Macedonia", image: "ohrid-macedonia"),
              Trip(destination: "Oia, Greece", image: "oia-greece"),
              Trip(destination: "Palawan, Philippines", image: "palawan-philippines"),
              Trip(destination: "Salerno, Italy", image: "salerno-italy"),
              Trip(destination: "Tokyo, Japan", image: "tokyo-japan"),
              Trip(destination: "West Vancouver, Canada", image: "west-vancouver-canada"),
              Trip(destination: "Singapore", image: "garden-by-bay-singapore"),
              Trip(destination: "Perhentian Islands, Malaysia", image: "perhentian-islands-malaysia")
            ]
#endif
```

# ****å»ºç«‹å¡ç‰‡è¦–åœ–èˆ‡é¸å–®åˆ—****

å°‡ä¸»è¢å¹•åˆ†æˆä¸‰å€‹éƒ¨åˆ†ï¼š

1. é ‚éƒ¨é¸å–®åˆ—ï¼ˆtop menu barï¼‰ã€‚
2. é ‚éƒ¨é¸å–®åˆ—ï¼ˆtop menu barï¼‰ã€‚
3. åº•éƒ¨é¸å–®åˆ—ï¼ˆbottom menu barï¼‰ã€‚

## ****å¡ç‰‡è¦–åœ–****

ç‚ºäº†è®“ç¨‹å¼ç¢¼æ›´æ˜“ç·¨å¯«ï¼Œæˆ‘å€‘å°‡åœ¨ä¸€å€‹å–®ç¨çš„æª”æ¡ˆä¸­å¯¦ä½œå¡ç‰‡è¦–åœ–ã€‚åœ¨å°ˆæ¡ˆå°è¦½å™¨ä¸­ï¼Œä½¿ç”¨ã€ŒSwiftUI Viewã€æ¨¡æ¿ä¾†å»ºç«‹æ–°æª”ï¼Œä¸¦å°‡å…¶å‘½åç‚ºÂ `CardView.swift`ã€‚

`CardView`Â æ˜¯è¨­è¨ˆç”¨ä¾†é¡¯ç¤ºä¸åŒçš„ç…§ç‰‡èˆ‡æ¨™é¡Œï¼Œå› æ­¤å®£å‘Šå…©å€‹è®Šæ•¸ä¾†å„²å­˜é€™äº›è³‡æ–™ï¼š

```swift
let image: String
let title: String
```

ä¸»è¢å¹•å°‡é¡¯ç¤ºä¸€å‰¯å¡ç‰‡è¦–åœ–ã€‚ç¨å¾Œï¼Œæˆ‘å€‘å°‡ä½¿ç”¨Â `ForEach`
Â ä¾†é€ä¸€åŸ·è¡Œå¡ç‰‡è¦–åœ–é™£åˆ—ä¸¦é¡¯ç¤ºå®ƒå€‘ã€‚å¦‚æœä½ é‚„è¨˜å¾—`ForEach`
Â çš„ç”¨æ³•ï¼Œé‚£éº¼ SwiftUI éœ€è¦çŸ¥é“å¦‚ä½•å”¯ä¸€è­˜åˆ¥é™£åˆ—ä¸­çš„æ¯å€‹é …ç›®ã€‚å› æ­¤ï¼Œæˆ‘å€‘å°‡ä½¿Â `CardView`
Â éµå¾ª`Identifiable`
Â å”å®šï¼Œä¸¦å°å…¥ä¸€å€‹Â `id`
Â è®Šæ•¸ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
struct CardView: View, Identifiable {
    let id = UUID()
    let image: String
    let title: String

    .
    .
    .
}
```

ç¾åœ¨ï¼Œæˆ‘å€‘ç¹¼çºŒå¯¦ä½œå¡ç‰‡è¦–åœ–ï¼Œä¸¦æ›´æ–°Â `body`
Â è®Šæ•¸å¦‚ä¸‹ï¼š

```swift
var body: some View {
    Image(image)
        .resizable()
        .scaledToFill()
        .frame(minWidth: 0, maxWidth: .infinity)
        .cornerRadius(10)
        .padding(.horizontal, 15)
        .overlay(alignment: .bottom) {
            VStack {

                Text(title)
                    .font(.system(.headline, design: .rounded))
                    .fontWeight(.bold)
                    .padding(.horizontal, 30)
                    .padding(.vertical, 10)
                    .background(Color.white)
                    .cornerRadius(5)
            }
            .padding([.bottom], 20)
        }
}
```

ä½ é‚„ç„¡æ³•é è¦½å¡ç‰‡è¦–åœ–ï¼Œå› ç‚ºä½ å¿…é ˆåœ¨Â `CardView_Previews`
Â ä¸­åŒæ™‚æä¾›Â `image`
Â èˆ‡Â `title`
Â çš„å€¼ï¼Œå› æ­¤æ›´æ–°`CardView_Previews`
Â çµæ§‹å¦‚ä¸‹ï¼š

```swift
struct CardView_Previews: PreviewProvider {
    static var previews: some View {
        CardView(image: "yosemite-usa", title: "Yosemite, USA")
    }
}
```

æˆ‘åªæ˜¯ä½¿ç”¨ç´ æç›®éŒ„ä¸­çš„å…¶ä¸­ä¸€å¼µåœ–ç‰‡ä¾†é€²è¡Œé è¦½ï¼Œä½ å¯ä»¥ä¾è‡ªå·±çš„éœ€æ±‚éš¨æ„æ›´æ”¹åœ–ç‰‡åŠæ¨™é¡Œã€‚

# ****é¸å–®åˆ—èˆ‡ä¸» UI****

æº–å‚™å¥½å¡ç‰‡è¦–åœ–å¾Œï¼Œæˆ‘å€‘å¯ä»¥ç¹¼çºŒå¯¦ä½œä¸» UIã€‚å¦‚å‰æ‰€è¿°ï¼Œä¸» UI æœ‰å¡ç‰‡èˆ‡å…©å€‹é¸å–®åˆ—ï¼Œ å°æ–¼é€™å…©å€‹é¸å–®åˆ—ï¼Œæˆ‘å°‡ç‚ºå®ƒå€‘å€‹åˆ¥å»ºç«‹ä¸€å€‹å–®ç¨çš„Â `struct`ã€‚

ç¾åœ¨é–‹å•ŸÂ `ContentView.swift`Â ä¸¦é–‹å§‹å¯¦ä½œã€‚å°æ–¼é ‚éƒ¨é¸å–®åˆ—ï¼Œå»ºç«‹ä¸€å€‹æ–°çš„Â `struct`ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
struct TopBarMenu: View {
    var body: some View {
        HStack {
            Image(systemName: "line.horizontal.3")
                .font(.system(size: 30))
            Spacer()
            Image(systemName: "mappin.and.ellipse")
            .font(.system(size: 35))
            Spacer()
            Image(systemName: "heart.circle.fill")
            .font(.system(size: 30))
        }
        .padding()
    }
}
```

é€™ä¸‰å€‹åœ–ç¤ºä½¿ç”¨ç­‰è·çš„æ°´å¹³å †ç–Šä¾†æ’åˆ—ã€‚å°æ–¼åº•éƒ¨é¸å–®åˆ—ï¼Œå¯¦ä½œå¹¾ä¹ç›¸åŒã€‚åœ¨Â `Content View.swift`
Â ä¸­æ’å…¥ä¸‹åˆ—çš„ç¨‹å¼ç¢¼ï¼Œä»¥å»ºç«‹é¸å–®åˆ—ï¼š

```swift
struct BottomBarMenu: View {
    var body: some View {
        HStack {
            Image(systemName: "xmark")
                .font(.system(size: 30))
                .foregroundColor(.black)

            Button {
                // é å®šæ—…ç¨‹
            } label: {
                Text("BOOK IT NOW")
                    .font(.system(.subheadline, design: .rounded))
                .bold()
                    .foregroundColor(.white)
                    .padding(.horizontal, 35)
                    .padding(.vertical, 15)
                    .background(Color.black)
                    .cornerRadius(10)
            }
            .padding(.horizontal, 20)

            Image(systemName: "heart")
                .font(.system(size: 30))
                .foregroundColor(.black)
        }

    }
}
```

æˆ‘å€‘ä¸æ‰“ç®—å¯¦ä½œã€ŒBook Tripã€åŠŸèƒ½ï¼Œå› æ­¤å°‡å‹•ä½œå€å¡Šç•™ç©ºã€‚å‡è¨­ä½ äº†è§£å †ç–Šèˆ‡åœ–ç‰‡çš„å·¥ä½œåŸç†ï¼Œå‰‡å…¶é¤˜çš„ç¨‹å¼ç¢¼æ‡‰è©²ç„¡éœ€è§£é‡‹ã€‚

ç¾åœ¨æ›´æ–°Â `ContentView_Previews`
Â çµæ§‹å¦‚ä¸‹ï¼š

```swift
struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()

        TopBarMenu()
            .previewDisplayName("TopBarMenu")

        BottomBarMenu()
            .previewDisplayName("BottomBarMenu")
    }
}
```

é€™è£¡ï¼Œæˆ‘å€‘ä½¿ç”¨Â `Group`
Â ä¾†å°‡å¤šå€‹å…ƒä»¶çš„é è¦½é€²è¡Œåˆ†çµ„ã€‚ä¸æŒ‡å®šä»»ä½•çš„é è¦½é¸é …ï¼ˆå¦‚ContentViewï¼‰ï¼ŒXcode æœƒåœ¨ç›®å‰æ¨¡æ“¬å™¨ä¸Šé¡¯ç¤ºé è¦½ã€‚

æ›´æ–°Â `ContentView`
Â å¦‚ä¸‹ï¼š

```swift
struct ContentView: View {
    var body: some View {
        VStack {
            TopBarMenu()

            CardView(image: "yosemite-usa", title: "Yosemite, USA")

            Spacer(minLength: 20)

            BottomBarMenu()
        }
    }
}
```

# ****å¯¦ä½œå¡ç‰‡åº«****

åœ¨åšå¥½æ‰€æœ‰çš„æº–å‚™ä¹‹å¾Œï¼Œçµ‚æ–¼å¯ä»¥å¯¦ä½œå¦‚ Tinder èˆ¬çš„ UIã€‚å°æ–¼ä¹‹å‰å¾æœªç”¨é Tinder App çš„äººï¼Œè®“æˆ‘å…ˆè§£é‡‹ä¸€ä¸‹å¦‚ Tinder èˆ¬ UI çš„å·¥ä½œåŸç†ã€‚

å¯ä»¥å°‡ Tinder èˆ¬ UI æƒ³åƒç‚ºä¸€å‰¯æˆå †çš„å¡ç‰‡ï¼Œæ¯å¼µå¡ç‰‡éƒ½é¡¯ç¤ºä¸€å¼µç…§ç‰‡ã€‚åœ¨æˆ‘å€‘çš„ç¯„ä¾‹ App ä¸­ï¼Œç…§ç‰‡æ˜¯æ—…ç¨‹çš„ç›®çš„åœ°ã€‚å°‡æœ€ä¸Šé¢çš„å¡ç‰‡ï¼ˆå³ç¬¬ä¸€å€‹æ—…ç¨‹ï¼‰è¼•å¾®å‘å·¦æˆ–å‘å³æ»‘å‹•ï¼Œå³å¯æ­ç¤ºä¸‹ä¸€å¼µå¡ç‰‡ï¼ˆå³ä¸‹ä¸€å€‹æ—…ç¨‹ï¼‰ã€‚å¦‚æœä½¿ç”¨è€…æ”¾é–‹å¡ç‰‡ï¼ŒApp å°±æœƒå°‡å¡ç‰‡å¸¶å›åŸä¾†çš„ä½ç½®ã€‚ä¸éï¼Œç•¶ä½¿ç”¨è€…ç”¨åŠ›æ»‘å‹•æ™‚ï¼Œä»–/ å¥¹å¯ä»¥ä¸Ÿæ‰é€™å¼µå¡ç‰‡ï¼Œç„¶å¾ŒApp æœƒå°‡ç¬¬äºŒå¼µå¡ç‰‡å‘å‰ç§»å‹•ï¼Œæˆç‚ºæœ€ä¸Šé¢çš„å¡ç‰‡

æœ€ç›´æˆªäº†ç•¶çš„æ–¹å¼æ˜¯ï¼Œä½¿ç”¨Â `ZStack`Â å°‡æ¯å€‹å¡ç‰‡è¦–åœ–äº’ç›¸å †ç–Šï¼Œæˆ‘å€‘ä¾†è©¦è‘—åšé€™å€‹ã€‚æ›´æ–°Â `ContentView`Â çµæ§‹å¦‚ä¸‹ï¼š

```swift
struct ContentView: View {

    var cardViews: [CardView] = {

        var views = [CardView]()

        for trip in trips {
            views.append(CardView(image: trip.image, title: trip.destination))
        }

        return views
    }()

    var body: some View {
        VStack {
            TopBarMenu()

            ZStack {
                ForEach(cardViews) { cardView in
                    cardView
                }
            }

            Spacer(minLength: 20)

            BottomBarMenu()
        }
    }
}
```

åœ¨ä¸Šé¢çš„ç¨‹å¼ç¢¼ä¸­ï¼Œæˆ‘å€‘åˆå§‹åŒ–ä¸€å€‹åŒ…å«æ‰€æœ‰æ—…ç¨‹çš„Â `cardViews`
Â é™£åˆ—ï¼ˆå…¶åœ¨Â `Trip.swift`
Â æª”ä¸­å®šç¾©ï¼‰ã€‚åœ¨body è®Šæ•¸ä¸­ï¼Œæˆ‘å€‘é€ä¸€åŸ·è¡Œæ‰€æœ‰çš„å¡ç‰‡è¦–åœ–ï¼Œä¸¦å°‡å®ƒå€‘åŒ…è£¹åœ¨Â `ZStack`
Â ä¸­ä¾†ç›¸äº’é‡ç–Šã€‚

ç‚ºä»€éº¼å®ƒæœƒé¡¯ç¤ºå¦ä¸€å¼µåœ–ç‰‡å‘¢ï¼Ÿå¦‚æœä½ å¼•ç”¨åœ¨Â `Trip.swift`
Â ä¸­å®šç¾©çš„Â `trips`
Â é™£åˆ—ï¼Œåœ–ç‰‡æ˜¯é™£åˆ—çš„æœ€å¾Œä¸€å€‹å…ƒç´ ã€‚åœ¨`ForEach`
Â å€å¡Šä¸­ï¼Œç¬¬ä¸€å€‹æ—…ç¨‹æ˜¯æ”¾åœ¨å¡ç‰‡åº«çš„æœ€ä¸‹é¢ï¼Œå¦‚æ­¤æœ€å¾Œä¸€å€‹æ—…ç¨‹ä¾¿æˆç‚ºå¡ç‰‡åº«çš„æœ€ä¸Šé¢ç…§ç‰‡ã€‚

ç•¶æˆ‘å€‘å¯¦ä½œå¡ç‰‡åº«æ™‚ï¼Œå¯¦éš›ä¸Šæœ‰å…©å€‹å•é¡Œï¼š

1. .`trips`Â é™£åˆ—çš„ç¬¬ä¸€å€‹æ—…ç¨‹æ‡‰è©²æ˜¯æœ€ä¸Šé¢çš„å¡ç‰‡ï¼Œä½†æ˜¯ç¾åœ¨å»æ˜¯æœ€ä¸‹é¢çš„å¡ç‰‡ã€‚
2. æˆ‘å€‘ç‚º 15 å€‹æ—…ç¨‹æ¸²æŸ“äº† 15 å€‹å¡ç‰‡è¦–åœ–ã€‚å¦‚æœæœªä¾†æœ‰ 10,000 å€‹æ—…ç¨‹ï¼Œç”šè‡³æ›´å¤šæ™‚ï¼Œè©²æ€éº¼è¾¦å‘¢ï¼Ÿæˆ‘å€‘æ˜¯å¦æ‡‰è©²ç‚ºæ¯å€‹æ—…ç¨‹å»ºç«‹ä¸€å€‹å¡ç‰‡è¦–åœ–å‘¢ï¼Ÿæœ‰æ²’æœ‰é«˜æ•ˆç‡çš„æ–¹å¼ä¾†å¯¦ä½œå¡ç‰‡åº«å‘¢ï¼Ÿ

æˆ‘å€‘å…ˆä¾†è§£æ±ºå¡ç‰‡é †åºçš„å•é¡Œã€‚SwiftUI æä¾›Â `zIndex`ä¿®é£¾å™¨ï¼Œä¾†æŒ‡ç¤º ZStack ä¸­çš„è¦–åœ–é †åºã€‚zIndex å€¼è¼ƒé«˜çš„è¦–åœ–ï¼Œä½æ–¼è¼ƒä½å€¼çš„è¦–åœ–ä¹‹ä¸Šï¼Œå› æ­¤æœ€ä¸Šé¢çš„å¡ç‰‡æ‡‰è©²æœ‰æœ€å¤§çš„Â `zIndex`Â å€¼ã€‚

è€ƒæ…®åˆ°é€™ä¸€é»ï¼Œæˆ‘å€‘å…ˆåœ¨Â `ContentView`Â ä¸­å»ºç«‹ä»¥ä¸‹çš„æ–°å‡½æ•¸ï¼š

```swift
private func isTopCard(cardView: CardView) -> Bool {

    guard let index = cardViews.firstIndex(where: { $0.id == cardView.id }) else {
        return false
    }

    return index == 0
}
```

åœ¨é€ä¸€åŸ·è¡Œå¡ç‰‡è¦–åœ–æ™‚ï¼Œæˆ‘å€‘å¿…é ˆæ‰¾åˆ°ä¸€ç¨®è­˜åˆ¥æœ€ä¸Šé¢å¡ç‰‡çš„æ–¹å¼ã€‚ä¸Šé¢çš„å‡½å¼å¸¶å…¥ä¸€å€‹å¡ç‰‡è¦–åœ–ï¼Œæ‰¾å‡ºå…¶ç´¢å¼•ï¼Œä¸¦å‘Šè¨´ä½ å¡ç‰‡è¦–åœ–æ˜¯å¦ä½æ–¼æœ€ä¸Šé¢ã€‚

æ¥ä¸‹ä¾†ï¼Œæ›´æ–°Â `ZStack`Â çš„ç¨‹å¼ç¢¼å€å¡Šå¦‚ä¸‹ï¼š

```swift
ZStack {
    ForEach(cardViews) { cardView in
        cardView
            .zIndex(self.isTopCard(cardView: cardView) ? 1 : 0)
    }
}
```

æˆ‘å€‘ç‚ºæ¯å€‹å¡ç‰‡è¦–åœ–åŠ å…¥äº†Â `zIndex`Â ä¿®é£¾å™¨ã€‚å°æ–¼æœ€ä¸Šé¢çš„å¡ç‰‡ï¼Œæˆ‘å€‘ç‚ºå…¶æŒ‡å®šè¼ƒé«˜çš„Â `zIndex`Â å€¼ã€‚åœ¨é è¦½ç•«å¸ƒä¸­ï¼Œä½ ç¾åœ¨æ‡‰è©²æœƒçœ‹åˆ°ç¬¬ä¸€å€‹æ—…ç¨‹çš„ç…§ç‰‡ï¼ˆå³ç¾åœ‹å„ªå‹ç¾åœ°åœ‹å®¶å…¬åœ’ï¼‰ã€‚

å°æ–¼ç¬¬äºŒå€‹å•é¡Œï¼Œå‰‡æ›´è¤‡é›œäº›ï¼Œæˆ‘å€‘çš„ç›®æ¨™æ˜¯ç¢ºä¿å¡ç‰‡åº«å¯æ”¯æ´æ•¸ä»¥è¬è¨ˆçš„å¡ç‰‡è¦–åœ–ï¼Œ è€Œä¸éœ€è€—è²»å¤§é‡è³‡æºã€‚

æˆ‘å€‘ä¾†æ›´æ·±å…¥ç ”ç©¶ä¸€ä¸‹å¡ç‰‡åº«ã€‚æˆ‘å€‘æ˜¯å¦çœŸçš„éœ€è¦ç‚ºæ¯å¼µæ—…ç¨‹ç…§ç‰‡åˆå§‹åŒ–å€‹åˆ¥çš„å¡ç‰‡è¦–åœ–å‘¢ï¼Ÿè¦å»ºç«‹é€™å€‹å¡ç‰‡åº«UIï¼Œæˆ‘å€‘åªéœ€å»ºç«‹å…©å€‹å¡ç‰‡è¦–åœ–ï¼Œä¸¦å°‡å®ƒå€‘äº’ç›¸é‡ç–Šå³å¯ã€‚

ç•¶æœ€ä¸Šé¢çš„å¡ç‰‡è¦–åœ–è¢«ä¸Ÿæ£„æ™‚ï¼Œä¸‹é¢çš„å¡ç‰‡è¦–åœ–å°‡æˆç‚ºæœ€ä¸Šé¢çš„å¡ç‰‡ï¼›åŒæ™‚ï¼Œæˆ‘å€‘ç«‹å³ä½¿ç”¨ä¸åŒçš„ç…§ç‰‡åˆå§‹åŒ–ä¸€å€‹æ–°çš„å¡ç‰‡è¦–åœ–ï¼Œä¸¦å°‡å®ƒæ”¾åœ¨æœ€ä¸Šé¢çš„å¡ç‰‡å¾Œé¢ã€‚ç„¡è«–ä½ éœ€è¦åœ¨å¡ç‰‡åº«ä¸­é¡¯ç¤ºå¤šå°‘å¼µç…§ç‰‡ï¼ŒApp æ°¸é åªæœ‰å…©å€‹å¡ç‰‡è¦–åœ–ã€‚ä¸éï¼Œå¾ä½¿ç”¨è€…çš„è§’åº¦ä¾†çœ‹ï¼ŒUI æ˜¯ç”±ä¸€å †å¡ç‰‡æ‰€çµ„æˆã€‚

ç¾åœ¨ï¼Œä½ æ‡‰è©²äº†è§£æˆ‘å€‘å¦‚ä½•å»ºç«‹å¡ç‰‡åº«ï¼Œæˆ‘å€‘ä¾†ç¹¼çºŒé€²è¡Œå¯¦ä½œã€‚

é¦–å…ˆï¼Œæ›´æ–°Â `cardViews`Â é™£åˆ—ï¼Œæˆ‘å€‘ä¸å†éœ€è¦åˆå§‹åŒ–æ‰€æœ‰çš„æ—…ç¨‹ï¼Œè€Œåªéœ€è¦åˆå§‹åŒ–å‰å…©å€‹æ—…ç¨‹ã€‚ä¹‹å¾Œï¼Œç•¶ç¬¬ä¸€å€‹æ—…ç¨‹ï¼ˆå³ç¬¬ä¸€å¼µå¡ç‰‡ï¼‰è¢«ä¸Ÿæ£„æ™‚ï¼Œæˆ‘å€‘æœƒåŠ å…¥å¦ä¸€å¼µå¡ç‰‡ã€‚

```swift
var cardViews: [CardView] = {

    var views = [CardView]()

    for index in 0..<2 {
        views.append(CardView(image: trips[index].image, title: trips[index].destination))
    }

    return views
}()
```

æ›´æ”¹ç¨‹å¼ç¢¼ä¹‹å¾Œï¼ŒUI çœ‹èµ·ä¾†æ‡‰è©²å®Œå…¨ç›¸åŒã€‚ä½†åœ¨åº•å±¤æ¶æ§‹ä¸­ï¼Œä½ æ‡‰è©²åœ¨å¡ç‰‡åº«ä¸­åªçœ‹åˆ°å…©å€‹å¡ç‰‡è¦–åœ–ã€‚

# ****å¯¦ä½œæ»‘å‹•å‹•ä½œ****

åœ¨å‹•æ…‹å»ºç«‹æ–°çš„å¡ç‰‡è¦–åœ–ä¹‹å‰ï¼Œæˆ‘å€‘å¿…é ˆå…ˆå¯¦ä½œæ»‘å‹•åŠŸèƒ½ã€‚å¦‚æœä½ å¿˜è¨˜æ¹å¦‚ä½•è™•ç†æ‰‹å‹¢ï¼Œè«‹å†é–±è®€ç¬¬17 ç« åŠç¬¬18 ç« ã€‚æˆ‘å€‘å°‡æœƒé‡æ–°ä½¿ç”¨å‰é¢è¨è«–çš„ä¸€äº›ç¨‹å¼ç¢¼ã€‚

é¦–å…ˆï¼Œåœ¨Â `ContentView`Â ä¸­å®šç¾©Â `DragState`åˆ—èˆ‰ï¼Œå®ƒè¡¨ç¤ºå¯èƒ½çš„æ‹–æ›³ç‹€æ…‹ï¼š

```swift
enum DragState {
    case inactive
    case pressing
    case dragging(translation: CGSize)

    var translation: CGSize {
        switch self {
        case .inactive, .pressing:
            return .zero
        case .dragging(let translation):
            return translation
        }
    }

    var isDragging: Bool {
        switch self {
        case .dragging:
            return true
        case .pressing, .inactive:
            return false
        }
    }

    var isPressing: Bool {
        switch self {
        case .pressing, .dragging:
            return true
        case .inactive:
            return false
        }
    }

}
```

<aside>
ğŸ’¡ å†ä¸€æ¬¡ï¼Œå¦‚æœä½ ä¸äº†è§£ä»€éº¼æ˜¯åˆ—èˆ‰ï¼Œå‰‡è«‹åœ¨æ­¤è™•åœæ­¢ï¼Œä¸¦è¤‡ç¿’ä¸€ä¸‹æœ‰é—œæ‰‹å‹¢çš„ç« ç¯€ã€‚

</aside>

æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘å®šç¾©ä¸€å€‹`@GestureState`
Â è®Šæ•¸ä¾†å„²å­˜æ‹–æ›³ç‹€æ…‹ï¼Œé è¨­ä¸Šè¨­å®šç‚ºã€Œinactiveã€ï¼š

```swift
@GestureState private var dragState = DragState.inactive
```

ç¾åœ¨ï¼Œæ›´æ–°Â `body`
Â çš„éƒ¨åˆ†å¦‚ä¸‹ï¼š

```swift
var body: some View {
    VStack {
        TopBarMenu()

        ZStack {
            ForEach(cardViews) { cardView in
                cardView
                    .zIndex(self.isTopCard(cardView: cardView) ? 1 : 0)
                    .offset(x: self.dragState.translation.width, y:  self.dragState.translation.height)
                    .scaleEffect(self.dragState.isDragging ? 0.95 : 1.0)
                    .rotationEffect(Angle(degrees: Double( self.dragState.translation.width / 10)))
                    .animation(.interpolatingSpring(stiffness: 180, damping: 100), value: self.dragState.translation)
                    .gesture(LongPressGesture(minimumDuration: 0.01)
                        .sequenced(before: DragGesture())
                        .updating(self.$dragState, body: { (value, state, transaction) in
                            switch value {
                            case .first(true):
                                state = .pressing
                            case .second(true, let drag):
                                state = .dragging(translation: drag?.translation ?? .zero)
                            default:
                                break
                            }

                        })

                    )
            }
        }

        Spacer(minLength: 20)

        BottomBarMenu()
            .opacity(dragState.isDragging ? 0.0 : 1.0)
            .animation(.default, value: dragState.isDragging)
    }
}
```

åŸºæœ¬ä¸Šï¼Œæˆ‘å€‘å°‡æ‡‰ç”¨åœ¨æ‰‹å‹¢ç« ç¯€ä¸­æ‰€å­¸çš„çŸ¥è­˜ä¾†å¯¦ä½œæ‹–æ›³ã€‚`.gesture`
Â ä¿®é£¾å™¨æœ‰å…©å€‹æ‰‹å‹¢è­˜åˆ¥å™¨ï¼šé•·æŒ‰èˆ‡æ‹–æ›³ã€‚ç•¶åµæ¸¬åˆ°æ‹–æ›³æ‰‹å‹¢æ™‚ï¼Œæˆ‘å€‘æ›´æ–°Â `dragState`
Â è®Šæ•¸ï¼Œä¸¦å„²å­˜æ‹–æ›³çš„ä½ç§»é‡ã€‚

`offset`
ã€`scaleEffect`
ã€`rotationEffect`
Â èˆ‡Â `animation`
Â ä¿®é£¾å™¨çš„çµåˆï¼Œ å¯å»ºç«‹æ‹–æ›³æ•ˆæœã€‚æ‹–æ›³æ˜¯é€éæ›´æ–°å¡ç‰‡è¦–åœ–çš„Â `offset`
ä¾†å¯¦ç¾ã€‚ç•¶å¡ç‰‡è¦–åœ–è™•æ–¼æ‹–æ›³ç‹€æ…‹æ™‚ï¼Œæˆ‘å€‘æœƒä½¿ç”¨Â `scaleEffect`
Â å°‡å®ƒç¸®å°ä¸€é»ï¼Œä¸¦æ‡‰ç”¨`rotationEffect`
Â ä¿®é£¾å™¨å°‡å®ƒæ—‹è½‰ç‰¹å®šè§’åº¦ã€‚å‹•ç•«è¨­å®šç‚ºÂ `interpolatingSpring`
ï¼Œä½†ä½ å¯ä»¥è‡ªç”±å˜—è©¦å…¶ä»–å‹•ç•«ã€‚

æˆ‘å€‘é‚„å°Â `BottomBarMenu`
Â åšä¸€äº›ç¨‹å¼ç¢¼æ›´æ”¹ã€‚ç•¶ä½¿ç”¨è€…æ‹–æ›³å¡ç‰‡è¦–åœ–æ™‚ï¼Œæˆ‘æƒ³è¦éš±è—åº•éƒ¨åˆ—ï¼Œå› æ­¤æˆ‘å€‘æ‡‰ç”¨Â `.opacity`
Â ä¿®é£¾å™¨ï¼Œä¸¦ä¸”ç•¶å®ƒåœ¨æ‹–æ›³ç‹€æ…‹æ™‚ï¼Œè¨­å®šå®ƒçš„å€¼ç‚ºã€Œ0ã€ã€‚

ç•¶æ‹–æ›³é–‹å§‹æ™‚ï¼Œä½ å¯¦éš›ä¸Šæ˜¯åœ¨æ‹–æ›³æ•´å€‹å¡ç‰‡åº« ï¼å‡è¨­ä½¿ç”¨è€…åªèƒ½æ‹–æ›³æœ€ä¸Šé¢çš„å¡ç‰‡ï¼Œä¸‹é¢çš„å¡ç‰‡æ‡‰è©²ä¿æŒä¸è®Šã€‚è€Œä¸”ï¼Œç¸®æ”¾æ•ˆæœæ‡‰åªæ‡‰ç”¨æ–¼æœ€ä¸Šé¢çš„å¡ç‰‡ã€‚

è¦è§£æ±ºé€™äº›å•é¡Œï¼Œæˆ‘å€‘éœ€è¦ä¿®æ”¹Â `offset`
ã€`scaleEffect`
Â èˆ‡Â `rotationEffect`
Â ä¿®é£¾å™¨çš„ç¨‹å¼ç¢¼ï¼Œ å¦‚æ­¤æ‹–æ›³åªç™¼ç”Ÿåœ¨æœ€ä¸Šé¢çš„å¡ç‰‡è¦–åœ–ã€‚

```swift
ZStack {
    ForEach(cardViews) { cardView in
        cardView
            .zIndex(self.isTopCard(cardView: cardView) ? 1 : 0)
            .offset(x: self.isTopCard(cardView: cardView) ? self.dragState.translation.width : 0, y: self.isTopCard(cardView: cardView) ? self.dragState.translation.height : 0)
            .scaleEffect(self.dragState.isDragging && self.isTopCard(cardView: cardView) ? 0.95 : 1.0)
            .rotationEffect(Angle(degrees: self.isTopCard(cardView: cardView) ? Double( self.dragState.translation.width / 10) : 0))
            .animation(.interpolatingSpring(stiffness: 180, damping: 100), value: self.dragState.translation)
            .gesture(LongPressGesture(minimumDuration: 0.01)
                .sequenced(before: DragGesture())
                .updating(self.$dragState, body: { (value, state, transaction) in
                    switch value {
                    case .first(true):
                        state = .pressing
                    case .second(true, let drag):
                        state = .dragging(translation: drag?.translation ?? .zero)
                    default:
                        break
                    }

                })

            )
    }
}
```

åªéœ€è¦å°Â `offse`
ã€`scaleEffect`
Â èˆ‡Â `rotationEffect`
Â ä¿®é£¾å™¨é€²è¡Œä¿®æ”¹ï¼Œå…¶é¤˜çš„ç¨‹å¼ç¢¼ä¿æŒä¸è®Šã€‚å°æ–¼é‚£äº›ä¿®é£¾å™¨ï¼Œæˆ‘å€‘é€²è¡Œé¡å¤–çš„æª¢æŸ¥ï¼Œä»¥ä½¿æ•ˆæœåªæ‡‰ç”¨åœ¨æœ€ä¸Šé¢çš„å¡ç‰‡ã€‚

# ****é¡¯ç¤ºå¿ƒå½¢èˆ‡ Ã— å½¢åœ–ç¤º****

é…· ï¼æ‹–æ›³ç¾åœ¨å¯ä»¥é‹ä½œäº†ï¼Œä¸éå®ƒé‚„æ²’æœ‰å®Œæˆã€‚ä½¿ç”¨è€…æ‡‰è©²èƒ½å¤ å‘å³/ å‘å·¦æ»‘å‹•ï¼Œä¾†ä¸Ÿæ£„æœ€ä¸Šé¢çš„å¡ç‰‡ã€‚è€Œä¸”ï¼Œæ ¹æ“šæ»‘å‹•çš„æ–¹å‘ï¼Œå¡ç‰‡ä¸Šæ‡‰è©²é¡¯ç¤ºä¸€å€‹åœ–ç¤ºï¼ˆå¿ƒå½¢æˆ– Ã— å½¢ï¼‰ã€‚

é¦–å…ˆï¼Œæˆ‘å€‘åœ¨Â `ContentView`Â ä¸­å®£å‘Šä¸€å€‹æ‹–æ›³çš„ç•Œé™å€¼ï¼š

```swift
private let dragThreshold: CGFloat = 80.0
```

ç•¶æ‹–æ›³çš„ä½ç§»è¶…éç•Œé™å€¼æ™‚ï¼Œæˆ‘å€‘å°‡åœ¨å¡ç‰‡ä¸Šé‡ç–Šä¸€å€‹åœ–ç¤ºï¼ˆå¿ƒå½¢æˆ–Ã— å½¢ï¼‰ã€‚å¦å¤–ï¼Œ å¦‚æœä½¿ç”¨è€…é‡‹æ”¾å¡ç‰‡ï¼ŒApp æœƒå¾å¡ç‰‡åº«ä¸­åˆªé™¤é€™å¼µå¡ç‰‡ï¼Œä¸¦å»ºç«‹ä¸€å¼µæ–°å¡ç‰‡ï¼Œå°‡å…¶æ”¾ç½®æ–¼å¡ç‰‡åº«çš„æœ«å°¾ã€‚

è¦é‡ç–Šåœ–ç¤ºï¼ŒåŠ å…¥ä¸€å€‹Â `overlay`
Â ä¿®é£¾å™¨è‡³Â `cardViews`
ã€‚ä½ å¯ä»¥åœ¨Â `.zIndex`
Â ä¿®é£¾å™¨ä¸‹æ’å…¥ä¸‹åˆ—çš„ç¨‹å¼ç¢¼ï¼š

```swift
.overlay {
    ZStack {
        Image(systemName: "x.circle")
            .foregroundColor(.white)
            .font(.system(size: 100))
            .opacity(self.dragState.translation.width < -self.dragThreshold && self.isTopCard(cardView: cardView) ? 1.0 : 0)

        Image(systemName: "heart.circle")
            .foregroundColor(.white)
            .font(.system(size: 100))
            .opacity(self.dragState.translation.width > self.dragThreshold  && self.isTopCard(cardView: cardView) ? 1.0 : 0.0)
    }
}
```

é è¨­ä¸Šï¼Œå°‡ä¸é€æ˜åº¦è¨­å®šç‚ºã€Œ0ã€ä¾†éš±è—é€™å…©å¼µåœ–ç‰‡ã€‚å¦‚æœå‘å³æ‹–æ›³ï¼Œå‰‡ä½ç§»çš„å¯¬åº¦ç‚ºæ­£å€¼ï¼Œå¦å‰‡å…¶ç‚ºè² å€¼ã€‚ä¾ç…§æ‹–æ›³çš„æ–¹å‘ï¼Œç•¶æ‹–æ›³çš„ä½ç§»è¶…éç•Œé™å€¼æ™‚ï¼ŒApp å°‡é¡¯ç¤ºå…¶ä¸­ä¸€å¼µåœ–ç‰‡ã€‚

# ****åˆªé™¤/ æ’å…¥å¡ç‰‡****

ç¾åœ¨ï¼Œç•¶ä½ é‡‹æ”¾å¡ç‰‡æ™‚ï¼Œå®ƒä»æœƒå›åˆ°åŸä¾†çš„ä½ç½®ã€‚æˆ‘å€‘å¦‚ä½•æ‰èƒ½åˆªé™¤æœ€ä¸Šé¢çš„å¡ç‰‡ï¼Œ ä¸¦åŒæ™‚åŠ å…¥ä¸€å¼µæ–°å¡ç‰‡å‘¢ï¼Ÿ

é¦–å…ˆï¼Œæˆ‘å€‘ä½¿ç”¨Â `@State`Â ä¾†æ¨™è¨˜Â `cardViews`Â é™£åˆ—ï¼Œä»¥è®“æˆ‘å€‘å¯ä»¥æ›´æ–°å®ƒçš„å€¼ï¼Œä¸¦é‡æ–°æ›´æ–° UIï¼š

```swift
@State var cardViews: [CardView] = {

    var views = [CardView]()

    for index in 0..<2 {
        views.append(CardView(image: trips[index].image, title: trips[index].destination))
    }

    return views
}()
```

æ¥ä¸‹ä¾†ï¼Œå®£å‘Šå¦ä¸€å€‹ç‹€æ…‹è®Šæ•¸ä¾†è¿½è¹¤æ—…ç¨‹çš„æœ€å¾Œä¸€å€‹ç´¢å¼•ã€‚å‡è¨­å¡ç‰‡åº«ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ™‚ï¼Œæˆ‘å€‘é¡¯ç¤ºå„²å­˜åœ¨Â `trips`
Â é™£åˆ—ä¸­çš„å‰å…©å€‹æ—…ç¨‹ï¼Œæœ€å¾Œä¸€å€‹ç´¢å¼•è¨­å®šç‚ºÂ `1`
ã€‚

```swift
@State private var lastIndex = 1
```

ä¸‹é¢æ˜¯ç”¨æ–¼åˆªé™¤åŠæ’å…¥å¡ç‰‡è¦–åœ–çš„æ ¸å¿ƒå‡½æ•¸ã€‚å®šç¾©ä¸€å€‹åç‚ºÂ `moveCard`
Â æ–°å‡½æ•¸ï¼š

```swift
private func moveCard() {
    cardViews.removeFirst()

    self.lastIndex += 1
    let trip = trips[lastIndex % trips.count]

    let newCardView = CardView(image: trip.image, title: trip.destination)

    cardViews.append(newCardView)
}
```

é€™å€‹å‡½å¼å…ˆå¾Â `cardViews`
Â é™£åˆ—ä¸­åˆªé™¤æœ€ä¸Šé¢çš„å¡ç‰‡ï¼Œç„¶å¾Œå®ƒä½¿ç”¨å¾ŒçºŒæ—…ç¨‹çš„åœ–ç‰‡ä¾†å¯¦ä¾‹åŒ–ä¸€å€‹æ–°å¡ç‰‡è¦–åœ–ã€‚ç”±æ–¼Â `cardViews`
Â å®šç¾©ç‚ºç‹€æ…‹å±¬æ€§ï¼Œå› æ­¤ä¸€æ—¦é™£åˆ—çš„å€¼æ›´æ”¹æ™‚ï¼ŒSwiftUI å°‡å†æ¬¡æ¸²æŸ“å¡ç‰‡è¦–åœ–ï¼Œé€™å°±æ˜¯æˆ‘å€‘å¦‚ä½•åˆªé™¤æœ€ä¸Šé¢çš„å¡ç‰‡ï¼Œä¸¦æ’å…¥ä¸€å¼µæ–°å¡ç‰‡è‡³å¡ç‰‡åº«çš„æ–¹å¼ã€‚

é‡å°é€™å€‹ç¯„ä¾‹ï¼Œæˆ‘æƒ³è¦å¡ç‰‡åº«ç¹¼çºŒé¡¯ç¤ºä¸€å€‹æ—…ç¨‹ã€‚åœ¨Â `trips`Â é™£åˆ—çš„æœ€å¾Œä¸€å¼µåœ–ç‰‡é¡¯ç¤ºå¾Œï¼Œ App å°‡æœƒå›åˆ°ç¬¬ä¸€å€‹å…ƒç´ ï¼ˆæ³¨æ„ï¼Œä¸Šåˆ—ç¨‹å¼ç¢¼ä¸­çš„æ¨¡æ•¸é‹ç®—å­%ï¼‰ã€‚

æ¥ä¸‹ä¾†ï¼Œæ›´æ–°Â `.gesture`ä¿®é£¾å™¨ï¼Œä¸¦æ’å…¥Â `.onEnded`Â å‡½å¼ï¼š

```swift
.gesture(LongPressGesture(minimumDuration: 0.01)
    .sequenced(before: DragGesture())
    .updating(self.$dragState, body: { (value, state, transaction) in
        .
        .
        .
    })
    .onEnded({ (value) in

        guard case .second(true, let drag?) = value else {
            return
        }

        if drag.translation.width < -self.dragThreshold ||
            drag.translation.width > self.dragThreshold {

            self.moveCard()
        }
    })
)
```

ç•¶æ‹–æ›³æ‰‹å‹¢çµæŸæ™‚ï¼Œæˆ‘å€‘æª¢æŸ¥æ‹–æ›³çš„ä½ç§»æ˜¯å¦è¶…éç•Œé™å€¼ï¼Œä¸¦ç›¸æ‡‰å‘¼å«Â `moveCard()`ã€‚

# ****å¾®èª¿å‹•ç•«****

è¦å¾®èª¿å‹•ç•«æ•ˆæœï¼Œæˆ‘å€‘å°‡åŠ ä¸ŠÂ `transition`Â ä¿®é£¾å™¨ï¼Œä¸¦æ‡‰ç”¨ä¸å°ç¨±è½‰å ´è‡³å¡ç‰‡è¦–åœ–ã€‚

ç¾åœ¨å»ºç«‹ä¸€å€‹Â `AnyTransition`Â æ“´å±•ï¼ˆå¯ä»¥åŠ åœ¨Â `ContentView.swift`æœ€å¾Œç«¯ï¼‰ï¼Œä¸¦å®šç¾©å…©å€‹è½‰å ´æ•ˆæœï¼š

```swift
extension AnyTransition {
    static var trailingBottom: AnyTransition {
        AnyTransition.asymmetric(
            insertion: .identity,
            removal: AnyTransition.move(edge: .trailing).combined(with: .move(edge: .bottom))
        )

    }

    static var leadingBottom: AnyTransition {
        AnyTransition.asymmetric(
            insertion: .identity,
            removal: AnyTransition.move(edge: .leading).combined(with: .move(edge: .bottom))
        )
    }
}
```

ä¹‹æ‰€ä»¥ä½¿ç”¨ä¸å°ç¨±è½‰å ´ï¼Œæ˜¯å› ç‚ºæˆ‘å€‘åªæƒ³åœ¨å¡ç‰‡è¦–åœ–è¢«åˆªé™¤æ™‚ï¼Œå°è½‰å ´è¨­å®šå‹•ç•«ã€‚

æ¥ä¸‹ä¾†ï¼Œå®£å‘Šä¸€å€‹åŒ…å«è½‰å ´é¡å‹çš„ç‹€æ…‹å±¬æ€§ï¼Œé è¨­æ˜¯è¨­å®šÂ `trailingBottom`
ã€‚

```swift
@State private var removalTransition = AnyTransition.trailingBottom
```

ç¾åœ¨ï¼Œå°‡Â `.transition`
Â ä¿®é£¾å™¨åŠ åˆ°å¡ç‰‡è¦–åœ–ã€‚ä½ å¯ä»¥å°‡å®ƒæ”¾åœ¨Â `.animation`
Â ä¿®é£¾å™¨ä¹‹å¾Œï¼š

```swift
.transition(self.removalTransition)
```

æœ€å¾Œï¼Œä½¿ç”¨Â `onChanged`
Â å‡½å¼æ›´æ–°Â `.gesture`
Â ä¿®é£¾å™¨çš„ç¨‹å¼ç¢¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
.gesture(LongPressGesture(minimumDuration: 0.01)
    .sequenced(before: DragGesture())
    .updating(self.$dragState, body: { (value, state, transaction) in
        switch value {
        case .first(true):
            state = .pressing
        case .second(true, let drag):
            state = .dragging(translation: drag?.translation ?? .zero)
        default:
            break
        }

    })
    .onChanged({ (value) in
        guard case .second(true, let drag?) = value else {
            return
        }

        if drag.translation.width < -self.dragThreshold {
            self.removalTransition = .leadingBottom
        }

        if drag.translation.width > self.dragThreshold {
            self.removalTransition = .trailingBottom
        }

    })
    .onEnded({ (value) in

        guard case .second(true, let drag?) = value else {
            return
        }

        if drag.translation.width < -self.dragThreshold ||
            drag.translation.width > self.dragThreshold {

            self.moveCard()
        }
    })

)
```

ä¸Šåˆ—ç¨‹å¼ç¢¼çš„ä½œç”¨æ˜¯è¨­å®šÂ `removalTransition`
ï¼Œè½‰å ´é¡å‹æ˜¯æ ¹æ“šæ»‘å‹•æ–¹å‘ä¾†æ›´æ–°ã€‚ç¾åœ¨ï¼Œä½ å¯ä»¥å†æ¬¡åŸ·è¡Œ App äº†ï¼Œç•¶ä¸Ÿæ£„å¡ç‰‡æ™‚ï¼Œä½ æ‡‰è©²æœƒçœ‹åˆ°å‹•ç•«æ•ˆæœå·²æ”¹å–„ã€‚

# çµèª

å»¶ä¼¸Gestureçš„æ‡‰ç”¨ï¼Œè‘—é‡åœ¨ç•«é¢çš„è¡¨ç¾ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†çš„Codeéƒ½æ˜¯æ”¾åœ¨åŒä¸€å€‹ç•«é¢ä¸Šã€‚

è·Ÿè‘—åšä¸€æ¬¡å¤§æ¦‚çŸ¥é“è¦æ€éº¼ç”¨ã€‚