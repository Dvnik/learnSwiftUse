# ç¬¬ 7 ç«  äº†è§£ç‹€æ…‹èˆ‡ç¶å®š

Class: ç²¾é€šSwiftUI
Created: December 7, 2022 4:28 PM
Reviewed: No
Type: SwiftUI4

<aside>
ğŸ’¡ ç‹€æ…‹ç®¡ç†ï¼ˆstate managementï¼‰æ˜¯æ¯å€‹é–‹ç™¼è€…åœ¨æ‡‰ç”¨ç¨‹å¼é–‹ç™¼ä¸­å¿…é ˆè™•ç†çš„äº‹æƒ…ã€‚

</aside>

åœ¨ SwiftUI ä¸­ï¼Œå…§å»ºäº†ä¸€äº›ç‹€æ…‹ç®¡ç†çš„åŠŸèƒ½ï¼Œç‰¹åˆ¥æ˜¯å®ƒå°å…¥äº†ä¸€å€‹åç‚ºã€Œ`@State`ã€çš„å±¬æ€§åŒ…è£å™¨ï¼ˆ Property Wrapper ï¼‰ã€‚ç•¶ä½ ä½¿ç”¨Â `@State`Â ä¾†æ¨™è¨»ä¸€å€‹å±¬æ€§æ™‚ï¼ŒSwiftUI æœƒè‡ªå‹•å°‡å…¶å„²å­˜åœ¨ä½ çš„æ‡‰ç”¨ç¨‹å¼ä¸­çš„æŸè™•ã€‚æ­¤å¤–ï¼Œä½¿ç”¨è©²å±¬æ€§çš„è¦–åœ–æœƒè‡ªå‹•ç›£è½å±¬æ€§å€¼çš„è®Šæ›´ï¼Œç•¶ç‹€æ…‹æ”¹è®Šæ™‚ï¼ŒSwiftUI å°‡é‡æ–°è¨ˆç®—é€™äº›è¦–åœ–ï¼Œä¸¦æ›´æ–°æ‡‰ç”¨ç¨‹å¼çš„å¤–è§€ã€‚

# SwiftUIState****æ–°å°ˆæ¡ˆ****

æ–°å»ºå°ˆæ¡ˆä»¥å¾Œï¼Œåœ¨`ContentView.swift`ä¸­æ”¹æˆåªé¡¯ç¤ºä»¥ä¸‹çš„ç¨‹å¼ç¢¼ï¼š

```swift
Button {
    // åœ¨ã€Œæ’­æ”¾ã€èˆ‡ã€Œåœæ­¢ã€æŒ‰éˆ•ä¹‹é–“åˆ‡æ›
} label: {
    Image(systemName: "play.circle.fill")
        .font(.system(size: 150))
        .foregroundColor(.green)
}
```

# ****æ§åˆ¶æŒ‰éˆ•çš„ç‹€æ…‹****

æ¥çºŒä¸Šå€‹å‹•ä½œï¼Œè¦åšçš„æ˜¯ç•¶ä½¿ç”¨è€…é»æ“ŠæŒ‰éˆ•æ™‚ï¼Œå°‡æŒ‰éˆ•çš„å¤–è§€å¾ã€Œæ’­æ”¾ã€æ”¹ç‚ºã€Œåœæ­¢ã€ã€‚é¡¯ç¤ºã€Œåœæ­¢ã€æŒ‰éˆ•æ™‚ï¼ŒæŒ‰éˆ•çš„é¡è‰²ä¹Ÿæ‡‰è®Šæˆç´…è‰²ã€‚

ä»¥ä¸€å€‹å¸ƒæ—è®Šæ•¸å»å„²å­˜ç‹€æ…‹çš„è®ŠåŒ–ï¼Œå‘½åç‚º`isPlaying`ï¼š

```swift
struct ContentView: View {

    private var isPlaying = false

    var body: some View {
        Button {
            // åœ¨ã€Œæ’­æ”¾ã€èˆ‡ã€Œåœæ­¢ã€æŒ‰éˆ•ä¹‹é–“åˆ‡æ›
        } label: {
            Image(systemName: isPlaying ? "stop.circle.fill" : "play.circle.fill")
            .font(.system(size: 150))
            .foregroundColor(isPlaying ? .red : .green)
        }

    }
}
```

ç¾åœ¨çš„å•é¡Œæ˜¯ï¼ŒApp å¦‚ä½•ç›£è½ç‹€æ…‹ï¼ˆå³Â `isPlaying`Â ï¼‰çš„è®ŠåŒ–ï¼Œä¸¦è‡ªå‹•æ›´æ–°æŒ‰éˆ•å‘¢ï¼Ÿä½¿ç”¨ SwiftUIï¼Œä½ éœ€è¦åšçš„æ˜¯åœ¨Â `isPlaying`Â å±¬æ€§å‰é¢åŠ ä¸ŠÂ `@State`ã€‚

```swift
@State private var isPlaying = false
```

ç•¶æˆ‘å€‘å®£å‘Šå±¬æ€§ç‚ºä¸€å€‹ç‹€æ…‹è®Šæ•¸æ™‚ï¼ŒSwiftUI å°±æœƒç®¡ç†isPlaying çš„å„²å­˜å€ï¼Œä¸¦ç›£è½å…¶å€¼çš„è®ŠåŒ–ã€‚ç•¶Â `isPlaying`Â çš„å€¼æ›´æ”¹æ™‚ï¼ŒSwiftUI æœƒåƒç…§Â `isPlaying`ç‹€æ…‹ï¼Œä¾†è‡ªå‹•é‡æ–°è¨ˆç®—è¦–åœ–ã€‚é€™è£¡çš„è¦–åœ–æŒ‡çš„æ˜¯Â `Button`ã€‚

> åªèƒ½å¾è¦–åœ–çš„ bodyï¼ˆæˆ–è€…å¾è¢«å®ƒå‘¼å«çš„å‡½æ•¸ï¼‰å…§éƒ¨å­˜å–ä¸€å€‹ç‹€æ…‹å±¬æ€§ã€‚ç”±æ–¼é€™å€‹ç·£æ•…ï¼Œä½ æ‡‰è©²å®£å‘Šä½ çš„ç‹€æ…‹å±¬æ€§ç‚º privateï¼Œä»¥é˜²æ­¢ä½ çš„è¦–åœ–çš„ç”¨æˆ¶ç«¯å­˜å–å®ƒã€‚

â€” Apple çš„[å®˜æ–¹æ–‡ä»¶](https://developer.apple.com/documentation/swiftui/state)
> 

é‚„æ²’æœ‰å¯¦ä½œæŒ‰éˆ•çš„å‹•ä½œã€‚å› æ­¤ï¼Œä¿®æ”¹ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š

```swift
Button {
    // åœ¨ã€Œæ’­æ”¾ã€èˆ‡ã€Œåœæ­¢ã€æŒ‰éˆ•ä¹‹é–“åˆ‡æ›
    self.isPlaying.toggle()
} label: {
    Image(systemName: isPlaying ? "stop.circle.fill" : "play.circle.fill")
    .font(.system(size: 150))
    .foregroundColor(isPlaying ? .red : .green)
}
```

åœ¨Â `action`Â é–‰åŒ…ï¼ˆclosure ï¼‰ä¸­ï¼Œæˆ‘å€‘å‘¼å«Â `toggle()`Â æ–¹æ³•ä¾†å°‡å¸ƒæ—å€¼å¾Â `false`Â åˆ‡æ›ç‚ºÂ `true`ï¼Œæˆ–è€…å¾Â `true`Â åˆ‡æ›ç‚ºÂ `false`ã€‚åœ¨é è¦½ç•«å¸ƒä¸­ï¼Œè©¦è‘—åœ¨ã€Œæ’­æ”¾ã€èˆ‡ã€Œåœæ­¢ã€æŒ‰éˆ•ä¹‹é–“åˆ‡æ›

# ****ä½¿ç”¨ç¶å®š****

å»ºç«‹è¨ˆæ•¸å™¨æŒ‰éˆ•ï¼Œä¸å°‡å¸ƒæ—è®Šæ•¸å®£å‘Šç‚ºç‹€æ…‹ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€å€‹æ•´æ•¸ç‹€æ…‹è®Šæ•¸ä¾†è¿½è¹¤è¨ˆæ•¸ã€‚ç•¶é»æ“ŠæŒ‰éˆ•æ™‚ï¼Œé€™å€‹è¨ˆæ•¸å™¨æœƒå¢åŠ  1ã€‚

```swift
struct ContentView: View {
    
    @State private var counter = 1
    
    var body: some View {
        VStack {
            Button {
                counter += 1
            } label: {
                Circle()
                    .frame(width: 200, height: 200)
                    .foregroundColor(.red)
                    .overlay {
                        Text("\(counter)")
                            .font(.system(size: 100, weight: .bold, design: .rounded))
                            .foregroundColor(.white)
                    }
            }
        }
        .padding()
    }
}
```

ç¾åœ¨é€²ä¸€æ­¥ä¿®æ”¹ç¨‹å¼ç¢¼ï¼Œä»¥é¡¯ç¤ºä¸‰å€‹è¨ˆæ•¸å™¨æŒ‰éˆ•ï¼Œæ‰€æœ‰çš„æŒ‰éˆ•å…±äº«ç›¸åŒçš„å¤–è§€ã€‚èˆ‡å…¶è¤‡è£½ç¨‹å¼ç¢¼ï¼Œè¼ƒå¥½çš„ä½œæ³•æ˜¯å–å‡ºä¸€å€‹å…±ç”¨è¦–åœ–ä½œç‚ºå¯é‡è¤‡ä½¿ç”¨çš„å­è¦–åœ–ã€‚å› æ­¤ï¼Œæˆ‘å€‘å¯ä»¥å–å‡º Button ä¾†å»ºç«‹ä¸€å€‹ç¨ç«‹è¦–åœ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
struct CounterButton: View {
    @Binding var counter: Int

    var color: Color

    var body: some View {
        Button {
            counter += 1
        } label: {
            Circle()
                .frame(width: 200, height: 200)
                .foregroundColor(color)
                .overlay {
                    Text("\(counter)")
                        .font(.system(size: 100, weight: .bold, design: .rounded))
                        .foregroundColor(.white)
                }
        }
    }
}
```

`CounterButton`Â è¦–åœ–æ¥æ”¶ ã€Œcounterã€ èˆ‡ ã€Œcolorã€ ç­‰å…©å€‹åƒæ•¸ï¼Œä½ å¯ä»¥ä½¿ç”¨ç´…è‰²ä¾†å»ºç«‹æŒ‰éˆ•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
CounterButton(counter: $counter, color: .red)
```

`counter`Â è®Šæ•¸ä»¥Â `@Binding`Â ä¾†åšæ¨™è¨»ã€‚ç•¶ä½ å»ºç«‹ä¸€å€‹Â `CounterButton`Â å¯¦ä¾‹æ™‚ï¼Œcounter æœƒåŠ ä¸Šä¸€å€‹ $ ç¬¦è™Ÿä½œç‚ºå‰ç¶´ã€‚

å–å‡ºæŒ‰éˆ•è‡³ç¨ç«‹çš„è¦–åœ–å¾Œï¼Œ`CounterButton`Â è®ŠæˆÂ `ContentView`Â çš„å­è¦–åœ–ã€‚ç¾åœ¨ï¼Œè¨ˆæ•¸å™¨éå¢æ˜¯åœ¨`CounterButton`Â è¦–åœ–ä¸­å®Œæˆçš„ï¼Œè€Œä¸æ˜¯åœ¨Â `ContentView`Â ä¸­ã€‚`CounterButton`Â å¿…é ˆåœ¨Â `ContentView`Â ä¸­æœ‰ä¸€å€‹ç®¡ç†ç‹€æ…‹è®Šæ•¸çš„æ–¹å¼ã€‚

é€™å€‹Â `@Binding`Â é—œéµå­—æŒ‡ç¤ºå‘¼å«è€…å¿…é ˆæä¾›ç‹€æ…‹è®Šæ•¸çš„ç¶å®šã€‚é€™æ¨£åšå°±å¦‚åŒå»ºç«‹äº†Â `ContentView`Â ä¸­çš„Â `counter`Â ä»¥åŠÂ `CounterButton`Â ä¸­çš„Â `counter`Â ä¹‹é–“çš„é›™å‘é€£æ¥ã€‚æ›´æ–°Â `CounterButton`Â è¦–åœ–ä¸­çš„Â `counter`ï¼Œæœƒå°‡å…¶å€¼å‚³é€å›Â `ContentView`Â ä¸­çš„Â `counter`Â ç‹€æ…‹ã€‚

<aside>
ğŸ’¡ ç°¡å–®èªªå°±æ˜¯ç•¶é—œä¿‚åˆ°`@State`è®Šæ•¸çš„UIæ‹‰å‡ºå»åšç¨ç«‹çš„è¦–åœ–ä»¥å¾Œï¼Œå…¶Stateçš„ç‰¹æ€§é‚„æ˜¯ä¸è®Šï¼Œä½†æ”¹è®Šç”±ã€Œå–®ä¸€ã€è½‰ç‚ºã€Œé€šç”¨ã€çš„å•é¡Œã€‚SwiftUIè§£æ±ºé€™å€‹å•é¡Œå°±æ˜¯æ–°å¢`@Binding`æ¨™è¨»ï¼Œé€éé€™å€‹æ¨™è¨»åœ¨å»ºç«‹å¯¦é«”çš„æ™‚å€™èˆ‡`@State`çš„è®Šæ•¸åšé—œè¯ï¼Œå¦‚æ­¤ä¸€ä¾†å¤šå€‹Stateè®Šæ•¸çš„è®ŠåŒ–å°±èƒ½å¤ ç¬¦åˆå„å€‹ä¸åŒçš„UIå¯¦é«”ã€‚

</aside>

é‚£éº¼Â `$`Â ç¬¦è™Ÿæ˜¯ä»€éº¼å‘¢? åœ¨ SwiftUI ä¸­ï¼Œ ä½ ä½¿ç”¨ $ å‰ç¶´é‹ç®—å­å¾ç‹€æ…‹è®Šæ•¸å–å¾—ç¶å®šã€‚

åœ¨æ¸…æ¥šç¨ç«‹çš„Buttonè¦–åœ–å¦‚ä½•è£½ä½œä»¥å¾Œï¼Œå°±èƒ½å»ºç«‹å‡ºå¤šå€‹æŒ‰éˆ•ï¼š

```swift
struct ContentView: View {

    @State private var counter = 1

    var body: some View {
        VStack {
            CounterButton(counter: $counter, color: .blue)
            CounterButton(counter: $counter, color: .green)
            CounterButton(counter: $counter, color: .red)
        }
    }
}
```

å¦å¤–æä¾›ä¸€å€‹å°ç·´ç¿’ï¼Œä¿®æ”¹ä¸Šè¿°çš„ç¨‹å¼ç¢¼ï¼Œå–®ç¨æŒ‰éˆ•æœ‰ç¨ç«‹çš„è¨ˆæ•¸å™¨ï¼Œä»¥åŠä¸€å€‹ä¸»è¨ˆæ•¸å™¨ï¼Œä»¥è¨ˆç®—æ‰€æœ‰æŒ‰éˆ•ã€‚æˆ‘çš„ä½œæ³•å¦‚ä¸‹ï¼š

```swift
struct ContentView: View {
    
    @State private var counter1 = 1
    @State private var counter2 = 1
    @State private var counter3 = 1
    
    var body: some View {
        VStack {
            Text("\(counter1+counter2+counter3)")
                .font(.system(size: 150))
            
            HStack {
                CounterButton(counter: $counter1, color: .blue)
                CounterButton(counter: $counter2, color: .green)
                CounterButton(counter: $counter3, color: .red)
            }
            .padding()
            
        }
    }
}
```

# çµèª

<aside>
ğŸ’¡ åœ¨ SwiftUI ä¸­ï¼Œç‹€æ…‹çš„æ”¯æ´å¯ç°¡åŒ–æ‡‰ç”¨ç¨‹å¼é–‹ç™¼ä¸­çš„ç‹€æ…‹ç®¡ç†ã€‚äº†è§£ä»€éº¼æ˜¯Â `@State`
Â èˆ‡Â `@Binding`æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ç‚ºå®ƒå€‘å°æ–¼åœ¨ SwiftUI ä¸­åšã€Œç‹€æ…‹ç®¡ç†ã€èˆ‡ã€ŒUI æ›´æ–°ã€è€Œè¨€ï¼Œ ç™¼æ®äº†å¾ˆå¤§çš„ä½œç”¨ã€‚

</aside>

å› ç‚ºä¸åƒUIKitç›´æ¥æ‹‰ç·šç¶å®šUIèˆ‡Controllerï¼Œä¸”UIKitä¸èƒ½å’ŒSwiftUIä¸€æ¨£UIé‡ç”¨ã€‚å› æ­¤SwiftUIçš„Stateèˆ‡Bindingå°±æˆäº†é¡ä¼¼çš„ä»‹æ¥åšæ³•ï¼Œç†Ÿæ‚‰ä½¿ç”¨ä»¥å¾Œå°±èƒ½å¤ æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨SwiftUIã€‚