# ç¬¬ 15 ç«  ä½¿ç”¨Combineèˆ‡è¦–åœ–æ¨¡å‹å»ºç«‹è¨»å†Šè¡¨å–®

Class: ç²¾é€šSwiftUI
Created: December 14, 2022 4:34 PM
Reviewed: No
Type: SwiftUI4

ç¾åœ¨ä½ æ‡‰è©²å°æ–¼ Combine æœ‰äº†åŸºæœ¬çš„äº†è§£ï¼Œæˆ‘å€‘å°‡ç¹¼çºŒæ¢ç´¢ Combine å¦‚ä½•ä½¿ SwiftUI å‡ºé¡æ‹”èƒã€‚ç•¶é–‹ç™¼ä¸€å€‹çœŸå¯¦çš„ App æ™‚ï¼Œè®“ä½¿ç”¨è€…è¨»å†Šå¸³æˆ¶æ˜¯å¾ˆå¸¸è¦‹çš„ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘å°‡å»ºç«‹ä¸€å€‹å¸¶æœ‰ä¸‰å€‹æ–‡å­—æ¬„ä½çš„ç°¡å–®è¨»å†Šç•«é¢ã€‚æˆ‘å€‘çš„é‡é»æ˜¯è¡¨å–®é©—è­‰ï¼Œå› æ­¤å°‡ä¸é€²è¡Œå¯¦éš›è¨»å†Šï¼Œä½ å°‡å­¸ç¿’å¦‚ä½•åˆ©ç”¨Combine çš„å¼·å¤§åŠŸèƒ½ï¼Œä¾†é©—è­‰æ¯å€‹è¼¸å…¥æ¬„ä½ï¼Œä¸¦åœ¨è¦–åœ–æ¨¡å‹ä¸­ç·¨å¯«ç¨‹å¼ç¢¼ã€‚

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘å€‘å°‡æ¢ç´¢å¦‚ä½•åˆ©ç”¨ Combine æ¡†æ¶ä¾†åŸ·è¡Œè¡¨å–®é©—è­‰ã€‚

# ****ä½¿ç”¨ SwiftUI ä½ˆå±€è¡¨å–®****

æˆ‘å€‘å¾ä¸€å€‹ç·´ç¿’ä¾†é–‹å§‹æœ¬ç« ï¼Œä½¿ç”¨è‡³ç›®å‰ç‚ºæ­¢æ‰€å­¸çš„å…§å®¹ï¼Œä¾†ä½ˆå±€å¦‚åœ– 15.1 æ‰€ç¤ºçš„è¡¨å–® UIã€‚è¦åœ¨ SwiftUI ä¸­å»ºç«‹ä¸€å€‹æ–‡å­—æ¬„ä½ï¼Œä½ å¯ä»¥ä½¿ç”¨ TextField å…ƒä»¶ï¼Œè€Œå°æ–¼å¯†ç¢¼æ¬„ä½ï¼Œ SwiftUI æä¾›äº†ä¸€å€‹åç‚ºÂ `SecureField`å®‰å…¨æ–‡å­—æ¬„ä½ã€‚

è¦å»ºç«‹ä¸€å€‹æ–‡å­—æ¬„ä½ï¼Œéœ€è¦ä½¿ç”¨æ¬„ä½åç¨±èˆ‡ç¶å®šï¼ˆbinding ï¼‰ä¾†åˆå§‹åŒ– TextFieldï¼Œé€™å°‡æ¸²æŸ“ä¸€å€‹å¯ç·¨è¼¯çš„æ–‡å­—æ¬„ä½ï¼Œè€Œä½¿ç”¨è€…è¼¸å…¥æœƒå„²å­˜åœ¨çµ¦å®šçš„ç¶å®šä¸­ã€‚å’Œå…¶ä»–è¡¨å–®æ¬„ä½é¡ä¼¼ï¼Œä½ å¯ä»¥é€éä½¿ç”¨ç›¸é—œçš„ä¿®é£¾å™¨ä¾†ä¿®æ”¹å®ƒçš„å¤–è§€ã€‚ä¸‹é¢æ˜¯ç¯„ä¾‹ç¨‹å¼ç¢¼ç‰‡æ®µï¼š

```swift
TextField("Username", text: $username)
    .font(.system(size: 20, weight: .semibold, design: .rounded))
    .padding(.horizontal)
```

é€™å…©å€‹å…ƒä»¶çš„ç”¨æ³•éå¸¸ç›¸ä¼¼ï¼Œé™¤äº†å®‰å…¨æ¬„ä½æœƒè‡ªå‹•é®è”½ä½¿ç”¨è€…çš„è¼¸å…¥ï¼š

```swift
SecureField("Password", text: $password)
    .font(.system(size: 20, weight: .semibold, design: .rounded))
    .padding(.horizontal)
```

<aside>
ğŸ’¡ ä»¥ä¸‹å…§å®¹ä»¥ç¯„ä¾‹å°ˆæ¡ˆ`SwiftUIFormRegistration`ä½œç‚ºä¸»è¦åŠŸèƒ½è¬›è§£

</aside>

é–‹å•ŸÂ `ContentView.swift`Â æª”ï¼Œä¸¦é è¦½ç•«å¸ƒä¸­çš„ä½ˆå±€ï¼Œç°¡è¦æª¢è¦–ä¸€ä¸‹ç¨‹å¼ç¢¼ï¼Œå¾Â `RequirementText`Â è¦–åœ–é–‹å§‹ã€‚

```swift
struct RequirementText: View {

    var iconName = "xmark.square"
    var iconColor = Color(red: 251/255, green: 128/255, blue: 128/255)

    var text = ""
    var isStrikeThrough = false

    var body: some View {
        HStack {
            Image(systemName: iconName)
                .foregroundColor(iconColor)
            Text(text)
                .font(.system(.body, design: .rounded))
                .foregroundColor(.secondary)
                .strikethrough(isStrikeThrough)
            Spacer()
        }
    }
}
```

å¦‚æœä½ æª¢è¦–ä»»ä½•ä¸€å€‹æ¬„ä½è¦æ±‚æ–‡å­—ï¼Œå®ƒéƒ½æœ‰ä¸€å€‹åœ–ç¤ºåŠä¸€å€‹æ•˜è¿°ã€‚æˆ‘å€‘ç„¡é ˆå¾é ­é–‹å§‹å»ºç«‹æ¯ä¸€å€‹æ¬„ä½è¦æ±‚æ–‡å­—ï¼Œæˆ‘å€‘å¯ä»¥å°‡ç¨‹å¼ç¢¼ä¸€èˆ¬åŒ–ï¼Œä¸¦ç‚ºå…¶å»ºç«‹ä¸€å€‹é€šç”¨çš„ç¨‹å¼ç¢¼ã€‚

`RequirementText`è¦–åœ–æœ‰å››å€‹å±¬æ€§ï¼ŒåŒ…æ‹¬Â `iconName`ã€`iconColor`ã€`text`èˆ‡Â `isStrikeThrough`ã€‚å®ƒè¶³ä»¥å½ˆæ€§æ”¯æ´æ¬„ä½è¦æ±‚æ–‡å­—çš„ä¸åŒæ¨£å¼ï¼Œå¦‚æœä½ æ¥å—é è¨­çš„åœ–ç¤ºèˆ‡é¡è‰²ï¼Œå‰‡å¯å»ºç«‹å¦‚ä¸‹çš„æ¬„ä½è¦æ±‚æ–‡å­—ï¼š

```swift
RequirementText(text: "A minimum of 4 characters")
```

åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œæ‡‰è¦åŠƒæ‰æ¬„ä½è¦æ±‚æ–‡å­—ï¼Œä¸¦é¡¯ç¤ºä¸åŒçš„åœ–ç¤ºæˆ–é¡è‰²ã€‚ç¨‹å¼ç¢¼å¯æ’°å¯«å¦‚ä¸‹ï¼š

```swift
RequirementText(iconName: "lock.open", iconColor: Color.secondary, text: "A minimum of 8 characters", isStrikeThrough: true)
```

æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹FormField è¦–åœ–ã€‚åŒæ¨£çš„ï¼Œå¦‚æœä½ æª¢è¦–æ‰€æœ‰çš„æ–‡å­—æ¬„ä½ï¼Œå®ƒå€‘éƒ½æœ‰ä¸€å€‹å…±åŒçš„æ¨£å¼ï¼Œå³åœ“é«”å­—å‹æ¨£å¼çš„æ–‡å­—æ¬„ä½ï¼Œé€™å°±æ˜¯ç‚ºä½•æˆ‘å–å‡ºä¸€äº›é€šç”¨ç¨‹å¼ç¢¼ï¼Œä¸¦å»ºç«‹Â `FormField`Â è¦–åœ–çš„åŸå› ã€‚

```swift
struct FormField: View {
    var fieldName = ""
    @Binding var fieldValue: String

    var isSecure = false

    var body: some View {

        VStack {
            if isSecure {
                SecureField(fieldName, text: $fieldValue)
                    .font(.system(size: 20, weight: .semibold, design: .rounded))
                    .padding(.horizontal)

            } else {
                TextField(fieldName, text: $fieldValue)                 
                    .font(.system(size: 20, weight: .semibold, design: .rounded))
                    .padding(.horizontal)
            }

            Divider()
                .frame(height: 1)
                .background(Color(red: 240/255, green: 240/255, blue: 240/255))
                .padding(.horizontal)

        }
    }
}
```

ç”±æ–¼é€™å€‹é€šç”¨çš„Â `FormField`Â éœ€è¦åŒæ™‚è² è²¬æ–‡å­—æ¬„ä½èˆ‡å®‰å…¨æ¬„ä½ï¼Œå› æ­¤å®ƒæœ‰ä¸€å€‹åç‚ºÂ `isSecure`
çš„å±¬æ€§ã€‚å¦‚æœè¨­å®šç‚ºÂ `true`ï¼Œè¡¨å–®æ¬„ä½å°‡å»ºç«‹ç‚ºå®‰å…¨æ¬„ä½ã€‚åœ¨ SwiftUI ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨Â `Divider`
Â å…ƒä»¶ä¾†å»ºç«‹ä¸€æ¢ç·šã€‚åœ¨ç¨‹å¼ç¢¼ä¸­ï¼Œæˆ‘å€‘ä½¿ç”¨Â `frame`Â ä¿®é£¾å™¨ä¾†è®Šæ›´é«˜åº¦ç‚ºã€Œ1 é»ã€ã€‚

è¦å»ºç«‹ä½¿ç”¨è€…åç¨±æ¬„ä½ï¼Œä½ å¯ä»¥å°‡ç¨‹å¼ç¢¼æ’°å¯«å¦‚ä¸‹ï¼š

```swift
FormField(fieldName: "Username", fieldValue: $username)
```

å°æ–¼å¯†ç¢¼æ¬„ä½ï¼Œé™¤äº†Â `isSecure`Â åƒæ•¸è¨­å®šç‚º true ä¹‹å¤–ï¼Œç¨‹å¼ç¢¼ä¹Ÿéå¸¸ç›¸ä¼¼ï¼š

```swift
FormField(fieldName: "Password", fieldValue: $password, isSecure: true)
```

é‚£éº¼ï¼Œæˆ‘å€‘å›åˆ°Â `ContentView`Â çµæ§‹ï¼Œä¾†çœ‹è¡¨å–®æ˜¯å¦‚ä½•ä½ˆå±€ã€‚

```swift
struct ContentView: View {

    @State private var username = ""
    @State private var password = ""
    @State private var passwordConfirm = ""

    var body: some View {
        VStack {
            Text("Create an account")
                .font(.system(.largeTitle, design: .rounded))
                .bold()
                .padding(.bottom, 30)

            FormField(fieldName: "Username", fieldValue: $username)
            RequirementText(text: "A minimum of 4 characters")
                .padding()

            FormField(fieldName: "Password", fieldValue: $password, isSecure: true)
            VStack {
                RequirementText(iconName: "lock.open", iconColor: Color.secondary, text: "A minimum of 8 characters", isStrikeThrough: true)
                RequirementText(iconName: "lock.open", text: "One uppercase letter", isStrikeThrough: false)
            }
            .padding()

            FormField(fieldName: "Confirm Password", fieldValue: $passwordConfirm, isSecure: true)
            RequirementText(text: "Your confirm password should be the same as password", isStrikeThrough: false)
                .padding()
                .padding(.bottom, 50)

            Button(action: {
                // é€²å…¥ä¸‹ä¸€å€‹ç•«é¢
            }) {
                Text("Sign Up")
                    .font(.system(.body, design: .rounded))
                    .foregroundColor(.white)
                    .bold()
                    .padding()
                    .frame(minWidth: 0, maxWidth: .infinity)
                    .background(LinearGradient(gradient: Gradient(colors: [Color(red: 251/255, green: 128/255, blue: 128/255), Color(red: 253/255, green: 193/255, blue: 104/255)]), startPoint: .leading, endPoint: .trailing))
                    .cornerRadius(10)
                    .padding(.horizontal)

            }

            HStack {
                Text("Already have an account?")
                    .font(.system(.body, design: .rounded))
                    .bold()

                Button(action: {
                    // é€²å…¥ç™»å…¥ç•«é¢
                }) {
                    Text("Sign in")
                        .font(.system(.body, design: .rounded))
                        .bold()
                        .foregroundColor(Color(red: 251/255, green: 128/255, blue: 128/255))
                }
            }.padding(.top, 50)

            Spacer()
        }
        .padding()
    }

}
```

é¦–å…ˆï¼Œæˆ‘å€‘æœ‰ä¸€å€‹Â `VStack`Â å­˜æ”¾æ‰€æœ‰çš„è¡¨å–®å…ƒç´ ï¼Œå®ƒç”±æ¨™é¡Œé–‹å§‹ï¼Œæ¥è‘—æ˜¯æ‰€æœ‰çš„è¡¨å–®æ¬„ä½èˆ‡æ¬„ä½è¦æ±‚æ–‡å­—ã€‚æˆ‘å·²ç¶“è§£é‡‹éé€™äº›è¡¨å–®æ¬„ä½èˆ‡æ¬„ä½è¦æ±‚æ–‡å­—æ˜¯å¦‚ä½•å»ºç«‹çš„ï¼Œå› æ­¤æˆ‘å°‡ä¸å†è©³ç´°èªªæ˜ã€‚æˆ‘åŠ å…¥æ¬„ä½çš„æ˜¯Â `padding`Â ä¿®é£¾å™¨ï¼Œé€™å¯ä»¥è®“æ–‡å­—æ¬„ä½ä¹‹é–“åŠ å…¥é–“è·ã€‚

ã€Œè¨»å†Šã€æŒ‰éˆ•æ˜¯ä½¿ç”¨Â `Button`Â å…ƒä»¶æ‰€å»ºç«‹ï¼Œç›®å‰æ²’æœ‰å‹•ä½œã€‚æˆ‘æ‰“ç®—å°‡é€™å€‹å‹•ä½œé–‰åŒ…ç•™ç©ºï¼Œ å› ç‚ºæˆ‘å€‘çš„é‡é»æ˜¯è¡¨å–®é©—è­‰ã€‚åŒæ¨£çš„ï¼Œæˆ‘ç›¸ä¿¡ä½ æ‡‰è©²çŸ¥é“å¦‚ä½•è‡ªè¨‚æŒ‰éˆ•ï¼Œå› æ­¤æˆ‘å°‡ä¸å†å°å…¶è©³ç´°ä»‹ç´¹ï¼Œä½ å¯ä»¥éš¨æ™‚åƒè€ƒæŒ‰éˆ•ä¸€ç« çš„å…§å®¹ã€‚

æœ€å¾Œï¼Œæ˜¯ã€Œå·²ç¶“æœ‰å¸³è™Ÿã€çš„æ•˜è¿°æ–‡å­—ï¼Œé€™å€‹æ–‡å­—èˆ‡ã€Œç™»å…¥ã€æŒ‰éˆ•ä¸¦ä¸ä¸€å®šéœ€è¦ï¼Œæˆ‘åªæ˜¯æƒ³æ¨¡ä»¿å¸¸è¦‹çš„è¨»å†Šè¡¨å–®ã€‚

ä»¥ä¸Šæ˜¯æˆ‘ä½ˆå±€ä½¿ç”¨è€…è¨»å†Šç•«é¢çš„æ–¹å¼ã€‚å¦‚æœä½ å·²è©¦è‘—åšé€™å€‹ç·´ç¿’ï¼Œæˆ–è¨±å¯æå‡ºå…¶ä»–çš„è§£æ±ºæ–¹æ¡ˆï¼Œé€™å®Œå…¨æ²’å•é¡Œã€‚æˆ‘åªæ˜¯å‘Šè¨´ä½ å»ºç«‹è¡¨å–®çš„å…¶ä¸­ä¸€ç¨®æ–¹æ³•ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä½œç‚ºåƒè€ƒï¼Œä¸¦æå‡ºæ›´å¥½çš„å¯¦ä½œæ–¹å¼ã€‚

# ****äº†è§£ Combine****

åœ¨æ·±å…¥ç ”ç©¶è¡¨å–®é©—è­‰ç¨‹å¼ç¢¼ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†äº†è§£æ›´å¤šé—œæ–¼ Combine æ¡†æ¶çš„èƒŒæ™¯è³‡è¨Šã€‚å¦‚å‰ä¸€ç« æ‰€è¿°ï¼Œé€™å€‹æ–°æ¡†æ¶æä¾›äº†ä¸€å€‹å®£å‘Šå¼APIï¼Œç”¨æ–¼éš¨è‘—æ™‚é–“è™•ç†å€¼ã€‚

ã€Œéš¨è‘—æ™‚é–“è™•ç†å€¼ã€æ˜¯ä»€éº¼æ„æ€ï¼Ÿé€™äº›å€¼åˆæ˜¯ä»€éº¼ï¼Ÿ

æˆ‘å€‘ä»¥è¨»å†Šè¡¨å–®ç‚ºä¾‹ã€‚App èˆ‡ä½¿ç”¨è€…äº’å‹•æ™‚ï¼ŒæŒçºŒç”¢ç”Ÿ UI äº‹ä»¶ï¼Œå‡è¨­ä½¿ç”¨è€…åœ¨æ–‡å­—æ¬„ä½ä¸­è¼¸å…¥çš„æ¯å€‹æŒ‰éµï¼Œéƒ½æœƒè§¸ç™¼ä¸€å€‹äº‹ä»¶ï¼Œè€Œé€™å¯ä»¥æˆç‚ºå€¼çš„ä¸²æµ

é€™äº› UI äº‹ä»¶æ˜¯æ¡†æ¶æ‰€åƒç…§çš„ä¸€ç¨®é¡å‹çš„å€¼ã€‚é€™äº›å€¼çš„å¦ä¸€å€‹ä¾‹å­æ˜¯ç¶²è·¯äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼š å¾é ç«¯ä¼ºæœå™¨ä¸‹è¼‰ä¸€å€‹æª”æ¡ˆï¼‰ã€‚

> Combine æ¡†æ¶æä¾›ä¸€å€‹å®£å‘Šå¼æ–¹æ³•ï¼Œä¾›App è™•ç†äº‹ä»¶ã€‚ä½ å¯ä»¥ç‚ºçµ¦å®šçš„äº‹ä»¶æºå»ºç«‹å–®ä¸€è™•ç†éˆï¼ˆchainï¼‰ï¼Œè€Œä¸æ˜¯å¯¦ä½œå¤šå€‹å§”æ´¾å›å‘¼ï¼ˆdelegate callback ï¼‰æˆ–å®Œæˆè™•ç†é–‰åŒ…ï¼ˆcompletion handler closure ï¼‰ã€‚éˆçš„æ¯ä¸€å€‹éƒ¨åˆ†éƒ½æ˜¯ä¸€å€‹Combine é‹ç®—å­ï¼Œå°ä¸Šä¸€å€‹æ­¥é©Ÿæ”¶åˆ°çš„å…ƒç´ åŸ·è¡Œä¸åŒçš„å‹•ä½œã€‚

â€” Apple çš„[å®˜æ–¹æ–‡ä»¶](https://developer.apple.com/documentation/combine/receiving_and_handling_events_with_combine)
> 

ç™¼å¸ƒè€…èˆ‡è¨‚é–±è€…æ˜¯æ¡†æ¶çš„å…©å€‹æ ¸å¿ƒå…ƒç´ ã€‚ä½¿ç”¨ Combineï¼Œç™¼å¸ƒè€…å‚³é€äº‹ä»¶ï¼Œè¨‚é–±è€…è¨‚é–±ï¼Œä»¥å¾ç™¼å¸ƒè€…æ¥æ”¶å€¼ã€‚åŒæ¨£çš„ï¼Œæˆ‘å€‘ä»¥æ–‡å­—æ¬„ä½ç‚ºä¾‹ã€‚é€éä½¿ç”¨ Combineï¼Œä½¿ç”¨è€…åœ¨æ–‡å­—æ¬„ä½ä¸­è¼¸å…¥çš„æ¯å€‹æŒ‰éµï¼Œéƒ½æœƒè§¸ç™¼ä¸€å€‹å€¼æ›´æ”¹çš„äº‹ä»¶ã€‚è€Œå°ç›£æ§é€™äº›å€¼æ„Ÿèˆˆè¶£çš„è¨‚é–±è€…ï¼Œå¯ä»¥è¨‚é–±æ¥æ”¶é€™äº›äº‹ä»¶ï¼Œä¸¦é€²ä¸€æ­¥åŸ·è¡Œæ“ä½œï¼ˆä¾‹å¦‚ï¼šé©—è­‰ï¼‰ã€‚

èˆ‰ä¾‹è€Œè¨€ï¼Œä½ æ­£åœ¨å¯«ä¸€å€‹è¡¨å–®é©—è­‰å™¨ï¼Œå®ƒæœ‰æŒ‡ç¤ºè¡¨å–®æ˜¯å¦æº–å‚™å¥½é€å‡ºçš„å±¬æ€§ã€‚åœ¨é€™å€‹ä¾‹å­ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨`@Published`Â æ¨™è¨»ä¾†æ¨™è¨˜è©²å±¬æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
class FormValidator: ObservableObject {
    @Published var isReadySubmit: Bool = false
}
```

æ¯æ¬¡è®Šæ›´Â `isReadySubmit`Â çš„å€¼æ™‚ï¼Œå®ƒéƒ½æœƒå‘è¨‚é–±è€…ç™¼å¸ƒä¸€å€‹äº‹ä»¶ã€‚è¨‚é–±è€…æ¥æ”¶æ›´æ–°å¾Œçš„å€¼ï¼Œä¸¦ç¹¼çºŒè™•ç†ï¼Œä¾‹å¦‚ï¼šè¨‚é–±è€…å¯ä»¥ä½¿ç”¨è©²å€¼ä¾†åˆ¤æ–·æ˜¯å¦æ‡‰å•Ÿç”¨ã€Œé€å‡ºã€æŒ‰éˆ•ã€‚

ä½ å¯èƒ½æœƒè¦ºå¾—åœ¨ SwiftUI ä¸­Â `@Published`å’ŒÂ `@State`Â çš„é‹ä½œæ–¹å¼éå¸¸ç›¸ä¼¼ã€‚é›–ç„¶åœ¨é€™å€‹ä¾‹å­ï¼Œå®ƒçš„å·¥ä½œåŸç†å¹¾ä¹ç›¸åŒï¼Œä¸éÂ `@State`Â åªèƒ½æ‡‰ç”¨åœ¨å±¬æ–¼ç‰¹å®šSwiftUI è¦–åœ–çš„å±¬æ€§ã€‚å¦‚æœä½ æƒ³è¦å»ºç«‹ä¸å±¬æ–¼ç‰¹å®šè¦–åœ–æˆ–å¯ä»¥ç”¨æ–¼å¤šå€‹è¦–åœ–çš„è‡ªè¨‚é¡å‹çš„è©±ï¼Œå‰‡ä½ éœ€è¦å»ºç«‹ä¸€å€‹éµå¾Â `ObservableObject`
Â çš„é¡åˆ¥ï¼Œä¸¦ä»¥Â `@Published`Â æ¨™è¨»ä¾†æ¨™è¨˜é€™äº›å±¬æ€§ã€‚

# ****Combine èˆ‡ MVVM****

ç¾åœ¨ä½ æ‡‰è©²å…·å‚™ Combine çš„ä¸€äº›åŸºæœ¬è§€å¿µï¼Œæˆ‘å€‘ä¾†é–‹å§‹ä½¿ç”¨æ¡†æ¶å¯¦ä½œè¡¨å–®é©—è­‰ï¼Œä¸‹åˆ—æ˜¯æˆ‘å€‘å°‡è¦åšçš„äº‹æƒ…ï¼š

1. å»ºç«‹ä¸€å€‹è¦–åœ–æ¨¡å‹ä¾†è¡¨ç¤ºä½¿ç”¨è€…è¨»å†Šè¡¨å–®ã€‚
2. åœ¨è¦–åœ–æ¨¡å‹ä¸­å¯¦ä½œè¡¨å–®é©—è­‰ã€‚

æˆ‘çŸ¥é“ä½ å¿ƒè£¡å¯èƒ½æœƒæœ‰å¹¾å€‹å•é¡Œã€‚é¦–å…ˆï¼Œç‚ºä»€éº¼æˆ‘å€‘éœ€è¦å»ºç«‹è¦–åœ–æ¨¡å‹å‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥åœ¨ ContentView åŠ å…¥é€™äº›è¡¨å–®å±¬æ€§ä¸¦åŸ·è¡Œè¡¨å–®é©—è­‰å—ï¼Ÿ

ä½ çµ•å°å¯ä»¥é€™æ¨£åšï¼Œä½†æ˜¯éš¨è‘—å°ˆæ¡ˆè¦æ¨¡æŒçºŒæˆé•·ï¼Œæˆ–è€…è¦–åœ–è®Šå¾—æ›´åŠ è¤‡é›œï¼Œå°‡è¤‡é›œçš„å…ƒä»¶æ‹†æˆå¤šå±¤æ˜¯ä¸€å€‹è‰¯å¥½ä½œæ³•ã€‚

ã€Œé—œæ³¨é»åˆ†é›¢ã€ï¼ˆSeparation of concerns ï¼‰æ˜¯ç·¨å¯«å„ªç§€è»Ÿé«”çš„åŸºæœ¬åŸå‰‡ã€‚æˆ‘å€‘å¯ä»¥æŠŠè¦–åœ–åˆ†æˆè¦–åœ–åŠå…¶è¦–åœ–æ¨¡å‹ç­‰å…©å€‹å…ƒä»¶ï¼Œè€Œä¸æ˜¯å°‡æ‰€æœ‰çš„æ±è¥¿æ”¾åœ¨ä¸€å€‹è¦–åœ–ä¸­ã€‚è¦–åœ–æœ¬èº«æ˜¯è² è²¬ UI ä½ˆå±€ï¼Œè€Œè¦–åœ–æ¨¡å‹å­˜æ”¾è¦åœ¨è¦–åœ–ä¸­é¡¯ç¤ºçš„ç‹€æ…‹èˆ‡è³‡æ–™ï¼Œä¸¦ä¸”è¦–åœ–æ¨¡å‹é‚„è™•ç†è³‡æ–™é©—è­‰èˆ‡è½‰æ›ã€‚å°æ–¼æœ‰ç¶“é©—çš„é–‹ç™¼è€…è€Œè¨€ï¼Œä½ çŸ¥é“æˆ‘å€‘æ­£æ‡‰ç”¨çœ¾æ‰€å‘¨çŸ¥çš„ã€ŒMVVMã€ï¼ˆModel- View-ViewModel çš„ç¸®å¯«ï¼‰è¨­è¨ˆæ¨¡å¼ã€‚

æ‰€ä»¥ï¼Œé€™å€‹è¦–åœ–æ¨¡å‹å°‡ä¿å­˜å“ªäº›è³‡æ–™å‘¢ï¼Ÿ

å†çœ‹ä¸€æ¬¡è¨»å†Šè¡¨å–®ï¼Œæˆ‘å€‘æœ‰ä¸‰å€‹æ–‡å­—æ¬„ä½ï¼ŒåŒ…æ‹¬ï¼š

- ä½¿ç”¨è€…åç¨±ã€‚
- å¯†ç¢¼ã€‚
- å¯†ç¢¼ç¢ºèªã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œé€™å€‹è¦–åœ–æ¨¡å‹å°‡å­˜æ”¾é€™äº›æ¬„ä½è¦æ±‚æ–‡å­—çš„ç‹€æ…‹ï¼Œä»¥æŒ‡ç¤ºæ˜¯å¦æ‡‰è©²åˆªæ‰å®ƒå€‘ï¼š

- æœ€å°‘4å€‹å­—å…ƒï¼ˆä½¿ç”¨è€…åç¨±ï¼‰ã€‚
- æœ€å°‘8å€‹å­—å…ƒï¼ˆå¯†ç¢¼ï¼‰ã€‚
- ä¸€å€‹å¤§å¯«å­—æ¯ï¼ˆå¯†ç¢¼ï¼‰ã€‚
- ä½ çš„ç¢ºèªå¯†ç¢¼æ‡‰èˆ‡å¯†ç¢¼ç›¸åŒï¼ˆå¯†ç¢¼ç¢ºèªï¼‰ã€‚

å› æ­¤ï¼Œè¦–åœ–æ¨¡å‹å°‡å…·æœ‰ä¸ƒå€‹å±¬æ€§ï¼Œä¸¦ä¸”æ¯ä¸€å€‹å±¬æ€§å°‡å…¶å€¼çš„è®Šæ›´ç™¼å¸ƒçµ¦é‚£äº›æœ‰èˆˆè¶£æ¥æ”¶å€¼çš„äººã€‚è¦–åœ–æ¨¡å‹çš„åŸºæœ¬æ¶æ§‹å¯ä»¥å®šç¾©å¦‚ä¸‹ï¼š

```swift
class UserRegistrationViewModel: ObservableObject {
    // Input
    @Published var username = ""
    @Published var password = ""
    @Published var passwordConfirm = ""

    // Output
    @Published var isUsernameLengthValid = false
    @Published var isPasswordLengthValid = false
    @Published var isPasswordCapitalLetter = false
    @Published var isPasswordConfirmValid = false
}
```

é€™å°±æ˜¯è¡¨å–®è¦–åœ–çš„è³‡æ–™æ¨¡å‹ã€‚`username`ã€`password`Â èˆ‡Â `passwordConfirm`Â å±¬æ€§åˆ†åˆ¥å­˜æ”¾ä½¿ç”¨è€…åç¨±ã€å¯†ç¢¼èˆ‡å¯†ç¢¼ç¢ºèªçš„æ–‡å­—æ¬„ä½çš„å€¼ã€‚é€™å€‹é¡åˆ¥æ‡‰è©²éµå¾Â `ObservableObject`ã€‚æ‰€æœ‰é€™äº›å±¬æ€§éƒ½ä½¿ç”¨Â `@Published`Â ä¾†åšæ¨™è¨»ï¼Œå› ç‚ºæˆ‘å€‘æƒ³è¦åœ¨å€¼ç™¼ç”Ÿè®Šæ›´æ™‚é€šçŸ¥è¨‚é–±è€…ï¼Œä¸¦ç›¸æ‡‰åŸ·è¡Œé©—è­‰ã€‚

# ****ä½¿ç”¨Combine é©—è­‰ä½¿ç”¨è€…åç¨±****

å¥½çš„ï¼Œä»¥ä¸Šç‚ºè³‡æ–™æ¨¡å‹ï¼Œä¸éæˆ‘å€‘é‚„æ²’æœ‰è™•ç†è¡¨å–®é©—è­‰ã€‚æˆ‘å€‘è¦å¦‚ä½•ä¾ç…§è¦æ±‚ä¾†é©—è­‰ä½¿ç”¨è€…åç¨±ã€å¯†ç¢¼èˆ‡å¯†ç¢¼ç¢ºèªå‘¢ï¼Ÿ

ä½¿ç”¨ Combineï¼Œä½ å°±å¿…é ˆåŸ¹é¤Šç™¼å¸ƒè€…/ è¨‚é–±è€…æ€ç¶­æ¨¡å¼ä¾†è§£æ±ºå•é¡Œã€‚è€ƒæ…®åˆ°ä½¿ç”¨è€…åç¨±ï¼Œ æˆ‘å€‘é€™è£¡å…¶å¯¦æœ‰å…©å€‹ç™¼å¸ƒè€…ï¼š`username`Â èˆ‡`isUsernameLengthValid`ã€‚æ¯ç•¶ä½¿ç”¨è€…åœ¨ä½¿ç”¨è€…åç¨±æ¬„ä½ä¸Šæ•²æ“Šéµç›¤è¼¸å…¥æ™‚ï¼Œ`username`Â ç™¼å¸ƒè€…å°±æœƒç™¼å¸ƒå€¼çš„è®Šæ›´ï¼Œè€ŒÂ `isUsernameLengthValid`Â ç™¼å¸ƒè€…å°‡ä½¿ç”¨è€…è¼¸å…¥çš„é©—è­‰ç‹€æ…‹é€šçŸ¥è¨‚é–±è€…ã€‚å¹¾ä¹æ‰€æœ‰SwiftUI ä¸­çš„æ§åˆ¶å…ƒä»¶éƒ½æ˜¯è¨‚é–±è€…ï¼Œå› æ­¤æ¬„ä½è¦æ±‚æ–‡å­—è¦–åœ–å°‡ç›£è½é©—è­‰çµæœçš„è®ŠåŒ–ï¼Œä¸¦ç›¸æ‡‰æ›´æ–°å…¶æ¨£å¼ï¼ˆå³æ˜¯å¦æœ‰åˆªé™¤ç·šï¼‰ã€‚

é€™è£¡ç¼ºå°‘çš„æ˜¯é€£æ¥å…©å€‹ç™¼å¸ƒè€…ä¹‹é–“çš„æ±è¥¿ï¼Œä¸¦ä¸”é€™å€‹ã€Œæ±è¥¿ã€è¦è™•ç†ä¸‹åˆ—çš„ä»»å‹™ï¼š

- ç›£è½Â `username`Â çš„è®ŠåŒ–ã€‚
- é©—è­‰ä½¿ç”¨è€…åç¨±èˆ‡å›å‚³é©—è­‰çµæœï¼ˆtrue/falseï¼‰ã€‚
- æŒ‡å®šçµæœè‡³Â `isUsernameLengthValid`ã€‚

å¦‚æœä½ å°‡ä»¥ä¸Šçš„éœ€æ±‚è½‰æ›æˆç¨‹å¼ç¢¼ï¼Œä¸‹é¢æ˜¯ç¨‹å¼ç¢¼ç‰‡æ®µï¼š

```swift
$username
    .receive(on: RunLoop.main)
    .map { username in
        return username.count >= 4
    }
    .assign(to: \.isUsernameLengthValid, on: self)
```

Combine æ¡†æ¶æä¾›å…©å€‹å…§å»ºçš„è¨‚é–±è€…ï¼šã€Œsinkã€èˆ‡ã€Œassignã€ã€‚Â `sink`Â å»ºç«‹ä¸€å€‹é€šç”¨è¨‚é–±è€…ä¾†æ¥æ”¶å€¼ï¼Œ`assign`Â å‰‡è®“ä½ å»ºç«‹å¦ä¸€ç¨®é¡å‹çš„è¨‚é–±è€…ï¼Œç”¨æ–¼æ›´æ–°ç‰©ä»¶çš„ç‰¹å®šå±¬æ€§ã€‚èˆ‰ä¾‹è€Œè¨€ï¼Œå®ƒå°‡é©—è­‰çµæœï¼ˆtrue/false ï¼‰æŒ‡å®šçµ¦Â `isUsernameLengthValid`ã€‚

æˆ‘å°‡æ·±å…¥èªªæ˜ä¸¦é€è¡Œæª¢è¦–ä¸Šåˆ—çš„ç¨‹å¼ç¢¼ã€‚`$username`Â æ˜¯æˆ‘å€‘æƒ³è¦ç›£è½çš„è®Šæ›´å€¼çš„ä¾†æºã€‚ç”±æ–¼æˆ‘å€‘è¨‚é–± UI äº‹ä»¶çš„è®ŠåŒ–ï¼Œå› æ­¤å‘¼å«Â `receive(on:)`Â å‡½æ•¸ä¾†ç¢ºä¿è¨‚é–±è€…åœ¨ä¸»åŸ·è¡Œç·’ï¼ˆå³Â `RunLoop.main`Â ï¼‰ä¸Šæ¥æ”¶åˆ°å€¼ã€‚

ç™¼å¸ƒè€…å‚³é€çš„å€¼æ˜¯ä½¿ç”¨è€…æ‰€è¼¸å…¥çš„ä½¿ç”¨è€…åç¨±ï¼Œä¸éè¨‚é–±è€…æ„Ÿèˆˆè¶£çš„æ˜¯ä½¿ç”¨è€…åç¨±çš„é•·åº¦æ˜¯å¦èƒ½å¤ æ»¿è¶³æœ€ä½è¦æ±‚ã€‚é€™è£¡ï¼Œ`map`Â å‡½æ•¸è¢«èªç‚ºæ˜¯Combine ä¸­çš„é‹ç®—å­ï¼Œå®ƒæ¥å—è¼¸å…¥ã€è™•ç†è¼¸å…¥ï¼Œä¸¦å°‡è¼¸å…¥è½‰æ›ç‚ºè¨‚é–±è€…æ‰€æœŸæœ›çš„å…§å®¹ï¼Œå› æ­¤æˆ‘å€‘åœ¨ä¸Šåˆ—çš„ç¨‹å¼ç¢¼ä¸­åšäº†ä¸‹åˆ—äº‹æƒ…ï¼š

1. æˆ‘å€‘å°‡ä½¿ç”¨è€…åç¨±ä½œç‚ºè¼¸å…¥ã€‚
2. ç„¶å¾Œï¼Œæˆ‘å€‘é©—è­‰ä½¿ç”¨è€…åç¨±ä¸¦ç¢ºèªè‡³å°‘æœ‰4å€‹å­—å…ƒï¼Œä¸¦é©—è­‰å…¶æ˜¯å¦è‡³å°‘åŒ…å«4å€‹å­—å…ƒã€‚
3. æœ€å¾Œï¼Œæˆ‘å€‘å°‡é©—è­‰çµæœä»¥å¸ƒæ—å€¼å›å‚³çµ¦è¨‚é–±è€…ã€‚

å°æ–¼é©—è­‰çµæœï¼Œ è¨‚é–±è€…åªéœ€å°‡çµæœè¨­å®šçµ¦Â `isUsernameLengthValid`Â å±¬æ€§ã€‚è«‹è¨˜å¾—Â `isUsernameLengthValid`Â ä¹Ÿæ˜¯ä¸€å€‹ç™¼å¸ƒè€…ï¼Œæˆ‘å€‘å¯ä»¥æ›´æ–°Â `RequirementText`Â æ§åˆ¶å…ƒä»¶ä¾†è¨‚é–±è®Šæ›´ï¼Œä¸¦ç›¸æ‡‰æ›´æ–° UIï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
RequirementText(iconColor: userRegistrationViewModel.isUsernameLengthValid ? Color.secondary : Color(red: 251/255, green: 128/255, blue: 128/255), text: "A minimum of 4 characters", isStrikeThrough: userRegistrationViewModel.isUsernameLengthValid)
```

åœ–ç¤ºçš„é¡è‰²èˆ‡åˆªé™¤ç·šçš„ç‹€æ…‹éƒ½å–æ±ºæ–¼é©—è­‰çµæœè€Œå®šï¼ˆä¹Ÿå°±æ˜¯Â `isUsernameLengthValid`Â ï¼‰ã€‚

é€™å°±æ˜¯æˆ‘å€‘å¦‚ä½•ä½¿ç”¨ Combine ä¾†é©—è­‰è¡¨å–®æ¬„ä½çš„æ–¹å¼ã€‚æˆ‘å€‘é‚„æ²’æœ‰å°‡ç¨‹å¼ç¢¼è®Šæ›´æ”¾å…¥æˆ‘å€‘çš„å°ˆæ¡ˆä¸­ï¼Œä¸éæˆ‘å¸Œæœ›è®“ä½ äº†è§£ç™¼å¸ƒè€…/ è¨‚é–±è€…çš„è§€å¿µï¼Œä»¥åŠæˆ‘å€‘å¦‚ä½•ä½¿ç”¨é€™å€‹æ–¹æ³•åŸ·è¡Œé©—è­‰ã€‚åœ¨å¾Œé¢çš„å°ç¯€ä¸­ï¼Œæˆ‘å€‘å°‡æ‡‰ç”¨æ‰€å­¸çš„çŸ¥è­˜ï¼Œä¸¦å°ç¨‹å¼ç¢¼é€²è¡Œæ›´æ”¹ã€‚

# ****ä½¿ç”¨ Combine é©—è­‰å¯†ç¢¼****

å¦‚æœä½ äº†è§£ä½¿ç”¨è€…åç¨±æ¬„ä½çš„é©—è­‰æ˜¯å¦‚ä½•å®Œæˆçš„ï¼Œæˆ‘å€‘å°‡å°å¯†ç¢¼èˆ‡å¯†ç¢¼ç¢ºèªé©—è­‰æ‡‰ç”¨é¡ä¼¼çš„å¯¦ä½œã€‚

å°æ–¼å¯†ç¢¼æ¬„ä½ï¼Œæœ‰å…©å€‹è¦æ±‚ï¼š

1. å¯†ç¢¼é•·åº¦è‡³å°‘æœ‰ 8 å€‹å­—å…ƒã€‚
2. æ‡‰è‡³å°‘åŒ…å«ä¸€å€‹å¤§å¯«å­—æ¯ã€‚

ç‚ºæ­¤ï¼Œæˆ‘å€‘å¯ä»¥è¨­å®šå…©å€‹è¨‚é–±è€…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
$password
    .receive(on: RunLoop.main)
    .map { password in
        return password.count >= 8
    }
    .assign(to: \.isPasswordLengthValid, on: self)

$password
    .receive(on: RunLoop.main)
    .map { password in
        let pattern = "[A-Z]"
        if let _ = password.range(of: pattern, options: .regularExpression) {
            return true
        } else {
            return false
        }
    }
    .assign(to: \.isPasswordCapitalLetter, on: self)
```

ç¬¬ä¸€å€‹è¨‚é–±è€…è¨‚é–±äº†å¯†ç¢¼é•·åº¦çš„é©—è­‰çµæœï¼Œä¸¦æŒ‡å®šçµ¦Â `isPasswordLengthValid`Â å±¬æ€§ã€‚ç¬¬äºŒå€‹æ˜¯è™•ç†å¤§å¯«å­—æ¯çš„é©—è­‰ã€‚æˆ‘å€‘ä½¿ç”¨Â `range`Â æ–¹æ³•ä¾†æ¸¬è©¦å¯†ç¢¼æ˜¯å¦è‡³å°‘åŒ…å«ä¸€å€‹å¤§å¯«å­—æ¯ã€‚åŒæ¨£çš„ï¼Œè¨‚é–±è€…å°‡é©—è­‰çµæœç›´æ¥æŒ‡å®šçµ¦å±¬æ€§ã€‚

å¥½çš„ï¼Œå‰©ä¸‹çš„æ˜¯å¯†ç¢¼ç¢ºèªæ¬„ä½çš„é©—è­‰ã€‚å°æ–¼é€™å€‹æ¬„ä½ï¼Œè¼¸å…¥è¦æ±‚æ˜¯å¯†ç¢¼ç¢ºèªæ‡‰èˆ‡å¯†ç¢¼æ¬„ä½çš„å¯†ç¢¼ç›¸åŒã€‚`password`Â èˆ‡Â `passwordConfirm`Â éƒ½æ˜¯ç™¼å¸ƒè€…ï¼Œç‚ºäº†é©—è­‰å…©å€‹ç™¼å¸ƒè€…æ˜¯å¦å…·æœ‰ç›¸åŒçš„å€¼ï¼Œæˆ‘å€‘ä½¿ç”¨Â `Publisher.combineLatest`ä¾†æ¥æ”¶èˆ‡çµåˆä¾†è‡ªç™¼å¸ƒè€…çš„æœ€æ–°å€¼ï¼Œç„¶å¾Œæˆ‘å€‘å¯ä»¥é©—è­‰å…©å€‹å€¼æ˜¯å¦ç›¸åŒã€‚ä¸‹åˆ—ç‚ºç¨‹å¼ç¢¼ç‰‡æ®µï¼š

```swift
Publishers.CombineLatest($password, $passwordConfirm)
    .receive(on: RunLoop.main)
    .map { (password, passwordConfirm) in
        return !passwordConfirm.isEmpty && (passwordConfirm == password)
    }
    .assign(to: \.isPasswordConfirmValid, on: self)
```

åŒæ¨£çš„ï¼Œæˆ‘å€‘æŒ‡å®šé©—è­‰çµæœçµ¦Â `isPasswordConfirmValid`Â å±¬æ€§ã€‚

# ****å¯¦ä½œ UserRegistrationViewModel****

ç¾åœ¨æˆ‘å·²ç¶“è§£é‡‹äº†å¯¦ä½œçš„æ–¹æ³•ï¼Œæˆ‘å€‘å°‡æ‰€æœ‰å…§å®¹æ”¾è‡³å°ˆæ¡ˆä¸­ã€‚é¦–å…ˆï¼Œä½¿ç”¨ ã€ŒSwift Fileã€ æ¨¡æ¿å»ºç«‹ä¸€å€‹æ–° Swift æª”ï¼Œå‘½åç‚ºÂ `UserRegistrationViewModel.swift`ï¼Œç„¶å¾Œä½¿ç”¨ä¸‹åˆ—ç¨‹å¼ç¢¼æ›¿æ›æ•´å€‹æª”æ¡ˆå…§å®¹ï¼š

```swift
import Foundation
import Combine

class UserRegistrationViewModel: ObservableObject {
    // è¼¸å…¥
    @Published var username = ""
    @Published var password = ""
    @Published var passwordConfirm = ""

    // è¼¸å‡º
    @Published var isUsernameLengthValid = false
    @Published var isPasswordLengthValid = false
    @Published var isPasswordCapitalLetter = false
    @Published var isPasswordConfirmValid = false

    private var cancellableSet: Set<AnyCancellable> = []

    init() {
        $username
            .receive(on: RunLoop.main)
            .map { username in
                return username.count >= 4
            }
            .assign(to: \.isUsernameLengthValid, on: self)
            .store(in: &cancellableSet)

        $password
            .receive(on: RunLoop.main)
            .map { password in
                return password.count >= 8
            }
            .assign(to: \.isPasswordLengthValid, on: self)
            .store(in: &cancellableSet)

        $password
            .receive(on: RunLoop.main)
            .map { password in
                let pattern = "[A-Z]"
                if let _ = password.range(of: pattern, options: .regularExpression) {
                    return true
                } else {
                    return false
                }
            }
            .assign(to: \.isPasswordCapitalLetter, on: self)
            .store(in: &cancellableSet)

        Publishers.CombineLatest($password, $passwordConfirm)
            .receive(on: RunLoop.main)
            .map { (password, passwordConfirm) in
                return !passwordConfirm.isEmpty && (passwordConfirm == password)
            }
            .assign(to: \.isPasswordConfirmValid, on: self)
            .store(in: &cancellableSet)
    }
}
```

ä»¥ä¸Šçš„ç¨‹å¼ç¢¼å¹¾ä¹èˆ‡å‰é¢ç« ç¯€çš„ç¨‹å¼ç¢¼ç›¸åŒã€‚è¦ä½¿ç”¨ Combineï¼Œä½ éœ€è¦å…ˆåŒ¯å…¥ Combine æ¡†æ¶ã€‚åœ¨Â `init()`Â æ–¹æ³•ä¸­ï¼Œæˆ‘å€‘åˆå§‹åŒ–æ‰€æœ‰çš„è¨‚é–±è€…ä¾†ç›£è½æ–‡å­—æ¬„ä½çš„å€¼çš„è®Šæ›´ï¼Œä¸¦åŸ·è¡Œç›¸æ‡‰çš„é©—è­‰ã€‚

ç¨‹å¼ç¢¼èˆ‡æˆ‘å€‘ä¹‹å‰è¨è«–çš„ç¨‹å¼ç¢¼å¹¾ä¹ç›¸åŒï¼Œä½†ä½ å¯èƒ½æ³¨æ„åˆ°ä¸€ä»¶äº‹ï¼Œå³Â `cancellableSet`Â è®Šæ•¸ã€‚å°æ–¼æ¯ä¸€å€‹è¨‚é–±è€…ï¼Œæˆ‘å€‘åœ¨æœ€å¾Œå‘¼å«Â `store`Â å‡½æ•¸ã€‚

é€™äº›æ˜¯ä»€éº¼å‘¢ï¼Ÿ

`assign`Â å‡½æ•¸å»ºç«‹è¨‚é–±è€…ï¼Œä¸¦å›å‚³ä¸€å€‹å¯å–æ¶ˆçš„å¯¦ä¾‹ã€‚ä½ å¯ä»¥ä½¿ç”¨è©²å¯¦ä¾‹åœ¨é©ç•¶çš„æ™‚é–“å–æ¶ˆè¨‚é–±ã€‚`store`Â å‡½æ•¸å¯è®“æˆ‘å€‘å°‡å¯å–æ¶ˆçš„çš„åƒç…§å„²å­˜åˆ°ä¸€å€‹é›†åˆä¸­ï¼Œä»¥ä¾¿ç¨å¾Œçš„æ¸…ç†ã€‚å¦‚æœä½ ä¸å„²å­˜é€™å€‹åƒç…§ï¼Œå‰‡ App å¯èƒ½å‡ºç¾è¨˜æ†¶é«”æ´©æ¼çš„å•é¡Œã€‚

é‚£éº¼ï¼Œé€™å€‹ç¯„ä¾‹ä½•æ™‚æœƒé€²è¡Œæ¸…ç†å‘¢ï¼Ÿç”±æ–¼Â `cancellableSet`Â è¢«å®šç¾©ç‚ºè©²é¡åˆ¥çš„å±¬æ€§ï¼Œå› æ­¤ç•¶é¡åˆ¥è¢«å–æ¶ˆåˆå§‹åŒ–æ™‚ï¼Œå°‡æœƒå°è¨‚é–±é€²è¡Œæ¸…ç†åŠå–æ¶ˆã€‚

ç¾åœ¨åˆ‡æ›å›Â `ContentView.swift`ï¼Œä¸¦æ›´æ–° UI æ§åˆ¶å…ƒä»¶ã€‚é¦–å…ˆï¼Œå°‡ä¸‹åˆ—çš„ç‹€æ…‹è®Šæ•¸ï¼š

```swift
@State private var username = ""
@State private var password = ""
@State private var passwordConfirm = ""
```

ä»¥ä¸€å€‹è¦–åœ–æ¨¡å‹å–ä»£ï¼Œä¸¦å‘½åç‚ºÂ `userRegistrationViewModel`ï¼š

```swift
@ObservedObject private var userRegistrationViewModel = UserRegistrationViewModel()
```

æ¥ä¸‹ä¾†ï¼Œæ›´æ–°æ–‡å­—æ¬„ä½èˆ‡ä½¿ç”¨è€…åç¨±çš„æ¬„ä½è¦æ±‚æ–‡å­—å¦‚ä¸‹ï¼š

```swift
FormField(fieldName: "Username", fieldValue: $userRegistrationViewModel.username)
RequirementText(iconColor: userRegistrationViewModel.isUsernameLengthValid ? Color.secondary : Color(red: 251/255, green: 128/255, blue: 128/255), text: "A minimum of 4 characters", isStrikeThrough: userRegistrationViewModel.isUsernameLengthValid)
    .padding()
```

ç¾åœ¨ï¼Œ`fieldValue`Â åƒæ•¸å·²ç¶“è®Šæ›´ç‚ºÂ `$userRegistrationViewModel.username`ã€‚å°æ–¼æ¬„ä½è¦æ±‚æ–‡å­—ï¼ŒSwiftUI ç›£æ§Â `userRegistrationViewModel.isUsernameLengthValid`Â å±¬æ€§ï¼Œä¸¦ç›¸æ‡‰æ›´æ–°æ¬„ä½è¦æ±‚æ–‡å­—ã€‚

åŒæ¨£çš„ï¼Œæ›´æ–°å¯†ç¢¼èˆ‡å¯†ç¢¼ç¢ºèªæ¬„ä½çš„UI ç¨‹å¼ç¢¼å¦‚ä¸‹æ‰€ç¤ºï¼š

```swift
FormField(fieldName: "Password", fieldValue: $userRegistrationViewModel.password, isSecure: true)
VStack {
    RequirementText(iconName: "lock.open", iconColor: userRegistrationViewModel.isPasswordLengthValid ? Color.secondary : Color(red: 251/255, green: 128/255, blue: 128/255), text: "A minimum of 8 characters", isStrikeThrough: userRegistrationViewModel.isPasswordLengthValid)
    RequirementText(iconName: "lock.open", iconColor: userRegistrationViewModel.isPasswordCapitalLetter ? Color.secondary : Color(red: 251/255, green: 128/255, blue: 128/255), text: "One uppercase letter", isStrikeThrough: userRegistrationViewModel.isPasswordCapitalLetter)
}
.padding()

FormField(fieldName: "Confirm Password", fieldValue: $userRegistrationViewModel.passwordConfirm, isSecure: true)
RequirementText(iconColor: userRegistrationViewModel.isPasswordConfirmValid ? Color.secondary : Color(red: 251/255, green: 128/255, blue: 128/255), text: "Your confirm password should be the same as password", isStrikeThrough: userRegistrationViewModel.isPasswordConfirmValid)
    .padding()
    .padding(.bottom, 50)
```

å¦‚æ­¤ï¼Œç¾åœ¨å¯ä»¥æ¸¬è©¦ App äº†ã€‚å¦‚æœä½ å·²æ­£ç¢ºé€²è¡Œæ‰€æœ‰çš„ä¿®æ”¹ï¼Œå‰‡ App ç¾åœ¨æ‡‰è©²èƒ½é©—è­‰ä½¿ç”¨è€…è¼¸å…¥

# çµèª

å¤§æ¦‚äº†è§£ä¹Ÿå¤§æ¦‚ä¸äº†è§£ï¼Œå¤§è‡´ä¸Šå’Œ`@State`æ¨™ç±¤ä¸€è‡´ï¼Œä½†`@State`æ¨™ç±¤æ˜¯ç¶å®šåœ¨UIä¸Šï¼Œ`ObservableObject`å°±è®Šå¾—åƒæ˜¯ç‚ºäº†ç¨ç«‹é‹ä½œï¼Œä¸å’ŒViewæ›é‰¤çš„ViewModeã€‚

é‚„éœ€è¦å¤šå€‹å°ˆæ¡ˆç¯„ä¾‹æ‰æœƒé€æ¼¸ç†è§£ã€‚